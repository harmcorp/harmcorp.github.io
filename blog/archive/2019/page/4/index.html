
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://harmcorp.github.io/blog/archive/2019/page/4/">
      
      
        <link rel="prev" href="../../../2025/">
      
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>2019 - HARM CORP</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.d7758b05.min.css">
      
      


  
  
    
    
      
    
    
  
  
  <style>.md-tag.md-tag--rabbitmq{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.035 9.601h-7.677a.956.956 0 0 1-.962-.962V.962a.956.956 0 0 0-.962-.956H10.56a.956.956 0 0 0-.962.956V8.64a.956.956 0 0 1-.962.962H5.762a.956.956 0 0 1-.961-.962V.962A.956.956 0 0 0 3.839 0H.959a.956.956 0 0 0-.956.962v22.076A.956.956 0 0 0 .965 24h22.07a.956.956 0 0 0 .962-.962V10.58a.956.956 0 0 0-.962-.98zm-3.86 8.152a1.437 1.437 0 0 1-1.437 1.443h-1.924a1.437 1.437 0 0 1-1.436-1.443v-1.917a1.437 1.437 0 0 1 1.436-1.443h1.924a1.437 1.437 0 0 1 1.437 1.443z"/></svg>');}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2019" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="HARM CORP" class="md-header__button md-logo" aria-label="HARM CORP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HARM CORP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2019
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="HARM CORP" class="md-nav__button md-logo" aria-label="HARM CORP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HARM CORP
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    this is blog index!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/holidays/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Holidays
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2019">2019</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-27 00:00:00+00:00">August 27, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="redis"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/">Redis 기초</a></h2>
<blockquote>
<p><a href="https://bstar36.tistory.com/349">Redis 설정</a> 이 참 많다...</p>
<p>gcp 에서 docker 로 올린 redis 를 host 에서 설치한 redis-cli 로 공부를 해보자.
key-value 쌍으로 메모리에 저장되는 빠른 디비... 정도로 이해하고 있는데..</p>
</blockquote>
<h3 id="common-command"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#common-command">Common Command</a></h3>
<h4 id="_1"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#_1">모든키 검색</a></h4>
<pre><code class="language-shell">127.0.0.1:6379&gt; KEYS *
1) &quot;user:herdin&quot;
2) &quot;hset&quot;
3) &quot;hlist&quot;
4) &quot;redisTest1&quot;
5) &quot;counter&quot;
6) &quot;hello&quot;
</code></pre>
<h4 id="requirepass"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#requirepass">권한획득(requirepass 옵션 사용 시)</a></h4>
<pre><code class="language-shell">127.0.0.1:6379&gt; KEYS *
(error) NOAUTH Authentication required.
127.0.0.1:6379&gt; AUTH &lt;YOUR PASSWORD&gt;
OK
</code></pre>
<h3 id="data-type"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#data-type">Data Type</a></h3>
<p><a href="https://redis.io/topics/data-types">Redis Data Type</a></p>
<ul>
<li>Strings</li>
<li>Lists</li>
<li>Sets</li>
<li>Hashes</li>
<li>Sorted Sets</li>
<li>Bitmaps and HyperLogLogs</li>
</ul>
<h4 id="strings"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#strings">Strings</a></h4>
<p><a href="https://redis.io/commands/#string">String Function</a></p>
<blockquote>
<p>binary safe 하다는 뜻이 뭘까? 최대 512M
INCR, DECR, INCRBY
APPEND
GETRANGE, SETRANGE.</p>
</blockquote>
<pre><code class="language-shell">127.0.0.1:6379&gt; SET hello redis01234
OK
127.0.0.1:6379&gt; SET hello
&quot;redis01234&quot;

#INCR INCRBY DECR DECRBY
127.0.0.1:6379&gt; SET counter 1000
OK
127.0.0.1:6379&gt; INCR counter
(integer) 1001
127.0.0.1:6379&gt; INCRBY counter 50
(integer) 1051
127.0.0.1:6379&gt; DECR counter
(integer) 1050
127.0.0.1:6379&gt; DECRBY counter 10
(integer) 1040

#GETRANGE SETRANGE
127.0.0.1:6379&gt; GETRANGE hello 0 2
&quot;red&quot;
127.0.0.1:6379&gt; GETRANGE hello 0 3
&quot;redi&quot;
127.0.0.1:6379&gt; GETRANGE hello 1 2
&quot;ed&quot;
127.0.0.1:6379&gt; SETRANGE hello 2 !!
(integer) 10
127.0.0.1:6379&gt; GET hello
&quot;re!!s01234&quot;

#GETBIT SETBIT
127.0.0.1:6379&gt; GET hello
&quot;re!!s01234&quot;
127.0.0.1:6379&gt; GETBIT hello 0
(integer) 0
127.0.0.1:6379&gt; GETBIT hello 1
(integer) 1
127.0.0.1:6379&gt; GETBIT hello 5
(integer) 0
127.0.0.1:6379&gt; GETBIT hello 4
(integer) 0
127.0.0.1:6379&gt; SETBIT hello 0 1
(integer) 0
127.0.0.1:6379&gt; GET hello
&quot;\xf2e!!s01234&quot;
127.0.0.1:6379&gt; SETBIT hello 0 0
(integer) 1
127.0.0.1:6379&gt; GET hello
&quot;re!!s01234&quot;
</code></pre>
<h4 id="lists"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#lists">Lists</a></h4>
<blockquote>
<p>Lists 의 최대 길이는 2^32 - 1
LPUSH, LPOP, RPUSH, RPOP
LRANGE
LTRIM</p>
</blockquote>
<p><a href="https://redis.io/commands#list">List Function</a></p>
<pre><code class="language-shell">#LPUSH LPOP RPUSH RPOP
127.0.0.1:6379&gt; LPUSH hlist a
(integer) 1
127.0.0.1:6379&gt; LPUSH hlist b
(integer) 2
127.0.0.1:6379&gt; LPUSH hlist c
(integer) 3
127.0.0.1:6379&gt; RPOP hlist
&quot;a&quot;
127.0.0.1:6379&gt; LPOP hlist
&quot;c&quot;
127.0.0.1:6379&gt; LPOP hlist
&quot;b&quot;
127.0.0.1:6379&gt; LPOP hlist
(nil)

#LRANGE
127.0.0.1:6379&gt; LPUSH hlist a b c d e
(integer) 5
127.0.0.1:6379&gt; LRANGE hlist 0 1
1) &quot;e&quot;
2) &quot;d&quot;
127.0.0.1:6379&gt; LRANGE hlist 1 1
1) &quot;d&quot;
127.0.0.1:6379&gt; LRANGE hlist 0 0
1) &quot;e&quot;
127.0.0.1:6379&gt; LRANGE hlist 0 1
1) &quot;e&quot;
2) &quot;d&quot;
127.0.0.1:6379&gt; LRANGE hlist 0 100
1) &quot;e&quot;
2) &quot;d&quot;
3) &quot;c&quot;
4) &quot;b&quot;
5) &quot;a&quot;
127.0.0.1:6379&gt; LTRIM hlist 0 1
OK
127.0.0.1:6379&gt; LRANGE hlist 0 100
1) &quot;e&quot;
2) &quot;d&quot;
</code></pre>
<h4 id="sets"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#sets">Sets</a></h4>
<p>순서가 없는 Strings 모음. 최대크기 2^32-1
추가, 삭제, O(1) 시간에 조회
아래에 Command reference 를 링크할 거라 커맨드는 생략</p>
<p><a href="https://redis.io/commands#set">Sets Function</a></p>
<pre><code class="language-shell">#SADD SREM SPOP SRANDMEMBER SCARD SMEMBERS SISMEMBER
127.0.0.1:6379&gt; SADD hset one #add member &quot;one&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SADD hset two #add member &quot;two&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SADD hset three #add member &quot;three&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SADD hset four #add member &quot;four&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SMEMBERS hset #return all member from hset
1) &quot;one&quot;
2) &quot;four&quot;
3) &quot;three&quot;
4) &quot;two&quot;

127.0.0.1:6379&gt; SPOP hset #remove and return random member from hset
&quot;three&quot;
127.0.0.1:6379&gt; SPOP hset 2 #remove and return random 2 members from hset
1) &quot;two&quot;
2) &quot;one&quot;
127.0.0.1:6379&gt; SMEMBERS hset #return all member from hset
1) &quot;four&quot;

127.0.0.1:6379&gt; SADD hset five #add member &quot;five&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SADD hset six #add member &quot;six&quot; to hset
(integer) 1
127.0.0.1:6379&gt; SRANDMEMBER hset 3 #just return random 3 members from hset
1) &quot;five&quot;
2) &quot;six&quot;
3) &quot;four&quot;
127.0.0.1:6379&gt; SMEMBERS hset #return all member from hset
1) &quot;six&quot;
2) &quot;five&quot;
3) &quot;four&quot;
127.0.0.1:6379&gt; SCARD hset #return member count from hset
(integer) 3

127.0.0.1:6379&gt; SREM hset six #remove specific member from hset
(integer) 1

127.0.0.1:6379&gt; SMEMBERS hset #return all member from hset
1) &quot;five&quot;
2) &quot;four&quot;
127.0.0.1:6379&gt; SISMEMBER hset six #check specific member from hset
(integer) 0
</code></pre>
<h4 id="hashes-sorted-sets"><a class="toclink" href="../../../../2019/08/27/redis-%EA%B8%B0%EC%B4%88/#hashes-sorted-sets">Hashes, Sorted Sets 생략..</a></h4>
<p>참고
- <a href="https://www.zdnet.co.kr/view/?no=20131119174125">레디스 이렇게 쓰지 말자</a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-27 00:00:00+00:00">August 27, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="selinux"><a class="toclink" href="../../../../2019/08/27/selinux-%EA%B0%80-%EB%AD%90%EC%A7%80/">SELinux 가 뭐지</a></h2>
<h3 id="selinux_1"><a class="toclink" href="../../../../2019/08/27/selinux-%EA%B0%80-%EB%AD%90%EC%A7%80/#selinux_1">SELinux 란..</a></h3>
<p><a href="https://www.lesstif.com/pages/viewpage.action?pageId=18219476#SELinux사용하기-SELinux아키텍처">일단 참고한 링크..</a></p>
<blockquote>
<p>SELinux 는 리눅스 커널의 일부이며 다음과 같은 아키텍처를 갖고 있다. 시스템 콜은 SELinux 보안 모듈을 통해 보안 정책을 질의한 후에 처리되며 모든 시스템 콜에 대해 SELinux가 보안 정책을 확인해서 접근 허용 여부를 판단 해야 하므로 속도를 빠르게 하기 위해 캐슁하여 처리하고 있으며 이 부분을 AVC(Access Vector Cache) 라고 부른다.</p>
</blockquote>
<p><code>SELinux</code> 는 아래의 세 가지 모드로 동작한다.</p>
<table class="pure-table">
  <thead>
    <tr>
      <td>mode name</td>
      <td>mode behavior</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>enforce</td>
      <td>정책과 룰에 어긋나는 동작은 모두 차단</td>
    </tr>
    <tr>
      <td>permissive</td>
      <td>정책과 룰에 어긋나는 동작이 있을 경우, 감사 로그(audit log)를 남기고 해당 작업은 허용</td>
    </tr>
    <tr>
      <td>disable</td>
      <td>SELinux 사용하지 않음.</td>
    </tr>
  </tbody>
</table>

<p><code>Security Context</code> 는 사용자, 역할, 타입, 레벨 로 이루어져있다.
<code>ls</code> , <code>ps</code> 에 <code>-Z</code> 옵션을 주면 해당 객체의 <code>Security Context</code> 를 알 수 있다.
기본적인 접근통제는 <code>Type Enforcement</code> 가 수행하며, 해당 로그는 <code>/var/log/audit/audit.log</code> 에 남게된다.</p>
<h4 id="sestatus-selinux-status"><a class="toclink" href="../../../../2019/08/27/selinux-%EA%B0%80-%EB%AD%90%EC%A7%80/#sestatus-selinux-status">sestatus (SELinux status)</a></h4>
<p>SELinux 의 상태를 체크한다.</p>
<pre><code class="language-shell">[herdin86@instance-20190319-second ~]$ sestatus
SELinux status:                 enabled
SELinuxfs mount:                /sys/fs/selinux
SELinux root directory:         /etc/selinux
Loaded policy name:             targeted
Current mode:                   enforcing
Mode from config file:          enforcing
Policy MLS status:              enabled
Policy deny_unknown status:     allowed
Max kernel policy version:      31
</code></pre>
<h4 id="getenforce"><a class="toclink" href="../../../../2019/08/27/selinux-%EA%B0%80-%EB%AD%90%EC%A7%80/#getenforce">getenforce</a></h4>
<p>현재 <code>SELinux</code> 의 모드를 확인한다.</p>
<pre><code class="language-shell">[herdin86@instance-20190319-second ~]$ getenforce
Enforcing
</code></pre>
<h4 id="setenforce"><a class="toclink" href="../../../../2019/08/27/selinux-%EA%B0%80-%EB%AD%90%EC%A7%80/#setenforce">setenforce</a></h4>
<p>현재 <code>SELinux</code> 의 모드를 변경한다. 별다른 응답을 주진 않는다.</p>
<pre><code class="language-shell">[herdin86@instance-20190319-second ~]$ setenforce --help
usage:  setenforce [ Enforcing | Permissive | 1 | 0 ]

[root@instance-20190319-second ~]# setenforce 0
[root@instance-20190319-second ~]# getenforce
Permissive
</code></pre>
<p>이 명령어로 모드를 변경한다해도 재부팅하면 설정이 초기화 된다.
영구설정은 <code>/etc/sysconfig/selinux</code> 을 열어서 <code>SELINUX=enforcing</code> 을 수정해 주면 된다.
해제 후 다시 설정할때 부팅시간이 길어진다고 한다.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-21 00:00:00+00:00">August 21, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="_1"><a class="toclink" href="../../../../2019/08/21/%EC%95%94%ED%98%B8%ED%99%94-%EB%8C%80%EC%B9%AD%ED%82%A4%EC%99%80-%EA%B3%B5%EA%B0%9C%ED%82%A4/">암호화, 대칭키와 공개키</a></h2>
<h4 id="_2"><a class="toclink" href="../../../../2019/08/21/%EC%95%94%ED%98%B8%ED%99%94-%EB%8C%80%EC%B9%AD%ED%82%A4%EC%99%80-%EA%B3%B5%EA%B0%9C%ED%82%A4/#_2">대칭키</a></h4>
<p>암/복호화하는 키가 같은 방식을 말한다. 대표적으로 <code>OTP</code>, <code>AES</code>, <code>DES</code> 가 있다.</p>
<blockquote>
<p><code>OPT</code> One Time Password 는 흔히 사용하니까 그렇다치더라도, <code>AES</code> 와 <code>DES</code> 두개가 뭐가 다른지는 모른다.</p>
</blockquote>
<p>송신측에서 가진 암호화키와 수신측에서 가진 복호화키가 같은 경우이다.<br />
- 송/수신 측에서 암복호화를 해야하기 때문에 같은 키를 공유해야하고 -&gt; 공유 중 유출 가능성이 올라간다.
- 두군데서 같은 키를 관리하므로 관리포인트가 늘어난다 -&gt; 역시 유출가능성이 올라간다.</p>
<h4 id="_3"><a class="toclink" href="../../../../2019/08/21/%EC%95%94%ED%98%B8%ED%99%94-%EB%8C%80%EC%B9%AD%ED%82%A4%EC%99%80-%EA%B3%B5%EA%B0%9C%ED%82%A4/#_3">공개키</a></h4>
<p>송신측과 수신측에서 사용하는 암/복호화 키가 다른 경우를 말한다. 대표적으로 <code>RSA</code>, <code>DSA</code> 가 있다.</p>
<p>암호화 한 키로는 복호화할 수가 없다.<br />
그 말은, 공개키로 암호화한 정보를 공개키로 다시 복호화할 순 없지만, 개인키로는 복호화 할 수 있다.<br />
마찬가지로 개인키로 암호화한 정보는 개인키로 다시 복호화할 순 없지만, 공개키로 복호화할 수 있다.</p>
<p>수신측에서 미리 송신측에 공개키를 전달하고, 전달된 공개키로 암호화한 정보를 송신측에서 수신측으로 보낸다.<br />
그럼 수신측에서 갖고있는 개인키로 복호화를 한다.</p>
<blockquote>
<p>좀 더 자세하게 공부하고 싶은데 분명 다른거하다가 안할 듯해서 포스트를 마친다..</p>
</blockquote>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-21 00:00:00+00:00">August 21, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="oauth"><a class="toclink" href="../../../../2019/08/21/oauth/">OAuth</a></h2>
<p><code>OAuth</code> 를 알아보기 전에 용어 정리가 필요하다.
- Authentication : 인증, <code>내맘대로 해석 - 요청 대상이 예상하는 대상이 맞는지 확인하는 것.</code></p>
<blockquote>
<p>컴퓨터 보안에서 인증은 로그인 요청 등을 통해 통신 상에서 보내는 사람의 디지털 정체성을 확인하는 시도의 과정이다. <a href="https://ko.wikipedia.org/wiki/%EC%9D%B8%EC%A6%9D#%EC%BB%B4%ED%93%A8%ED%84%B0_%EB%B3%B4%EC%95%88">출처</a></p>
</blockquote>
<ul>
<li>Authorization : 허가, 인가, <code>내맘대로 해석- 요청 자원에 대한 접근 허가</code><blockquote>
<p>허가(허용; authorization)란 리소스에 대한 접근 권한 및 정책을 지정하는 기능이다. 정보 보안 및 컴퓨터 보안, 특히 접근 제어 분야와 관련이 있다.[1] 예를 들어 인사부서 직원들은 보통 직원 데이터를 열람할 수 있도록 허용되어 있는데, 이러한 정책은 일반적으로 컴퓨터 시스템에 접근 제어 규칙들로 저장된다. 컴퓨터 시스템은 어떤 (인증된) 리소스 수요자가 리소스에 대한 요청을 하면, 저장된 접근 제어 규칙들을 적용해 요청을 허가할지 거부할지를 결정한다. 여기서 리소스는 개개의 파일 또는 데이터, 컴퓨터 프로그램이나 프로그램의 일부 기능, 컴퓨터 하드웨어 및 장치 등을 포함한다. 그리고 리소스 수요자는 컴퓨터 사용자뿐만 아니라 컴퓨터 프로그램이나 다른 장치들이 될 수도 있다. <a href="https://ko.wikipedia.org/wiki/허가_(컴퓨터_과학)">출처</a></p>
</blockquote>
</li>
</ul>
<p><a href="https://tools.ietf.org/html/rfc6749">Request for Comments: 6749, RFC 6749</a></p>
<h3 id="oauth-10a"><a class="toclink" href="../../../../2019/08/21/oauth/#oauth-10a"><code>OAuth 1.0a</code></a></h3>
<p>1.0 이 기존에 있었지만, 보안이 수정된 1.0 revision A 이 표준 <code>RFC5849</code> 로 등록이 되었다고하니 1.0 revision A 만 살짝 맛보고 가면 되겠다. 지금 사용하는건 대부분 2.0 이니까..</p>
<h4 id="_1"><a class="toclink" href="../../../../2019/08/21/oauth/#_1">용어</a></h4>
<table class="pure-table">
<thead>
  <tr>
    <th>용어</th>
    <th>설명</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>User</td>
    <td>Service Provider 에 계정을 가지고 있으면서, Consumer 를 이용하려는 사용자</td>
  </tr>
  <tr>
    <td>Consumer</td>
    <td>OAuth 를 사용하는 Open API 를 제공하는 서비스</td>
  </tr>
  <tr>
    <td>Service Provider</td>
    <td>OAuth 인증을 사용해 Service Provider 의 기능을 사용하려는 애플리케이션이나 웹 서비스</td>
  </tr>
  <tr>
    <td>Request Token</td>
    <td>Consumer가 Service Provider 에게 접근 권한을 인증받기 위해 사용하는 값. 인증이 완료된 후에는 Access Token 으로 교환.</td>
  </tr>
  <tr>
    <td>Access Token</td>
    <td>인증 후 Consumer 가 Service Provider 의 자원에 접근하기 위한 키를 포함한 값</td>
  </tr>
</tbody>
</table>

<h4 id="flow"><a class="toclink" href="../../../../2019/08/21/oauth/#flow">Flow</a></h4>
<p><img alt="OAuth1.0 flow" src="/assets/images/posts/2019-08-21-oauth-02.png" /></p>
<p><code>OAuth 2.0</code> 을 먼저 배웠고, 어떤 형태를 거쳐 여기까지 왔는지 궁금하여 검색해 본 것인데, <code>Flow</code> 를 대충 보고 참고자료를 보며 느낀 점은 <code>음? 별로 크게 다르지 않은 것 같네?</code> 였다. 웹애플리케이션이 아닌 일반 애플리케이션에 대한 지원강화, HTTPS 사용으로 보안알고리즘 사용 자제, <code>Access Token</code> 의 만료적용. 이 정도가 크게 달라진 점 같다. 아 그냥 이랬구나 하고 넘어가련다.</p>
<h3 id="oauth-20"><a class="toclink" href="../../../../2019/08/21/oauth/#oauth-20"><code>OAuth 2.0</code></a></h3>
<h4 id="_2"><a class="toclink" href="../../../../2019/08/21/oauth/#_2">용어</a></h4>
<div id="pureTableHere"></div>
<script>
  util().genPureTable(
    'pureTableHere',
    ['용어', '설명'],
    [
      ['Client', 'OAuth 인증을 사용해 Resource Server 의 Resource Owner 의 Resource 를 획득하려는 애플리케이션이나 웹 서비스 (ex: Facebook 에 공유 기능을 제공하는 앱)'],
      ['Resource Owner', 'Resource 를 Resource Server 에 가지고 있으면서, Client 를 이용하려는 사용자 (ex: 일반사용자)'],
      ['Authoriztion Server', 'Authentication (인증) 이 끝난 뒤, 어떤 자원에 접근할지 Authorization (인가) 해 주는 서버'],
      ['Resource Server', 'Resource Owner 의 Resource 를 관리하는 서버'],
    ]
  );
</script>

<p>RFC 상에는 5가지 방식이 있다.
1. Authorization Code Grant - 아래에서 설명
2. Implicit Grant
  - 암시적 승인 - 보통 javascript 로 사용
  - user-agent(보통 브라우저) 에서 권한(Authorization)요청과 토큰요청이 분리되어 나감.<br />
  - client 의 인증(authentication) 이 없다.
  - access token 이 redirection URI 에 노출된다.
  - refresh token 이 없다.
3. Resource Owner Password Credentials Grant
  - resource owner(유저) 의 비밀번호를 app 에서 저장하는 방법
4. Client Credentials Grant
  - app(client) 의 자격만 가지고 토큰을 발급받는 방법
  - app 을 신뢰하기 때문에 다른 인증 필요 없이 바로 토큰을 발급해준다.
  - 보통은 Authorization Server 와 Client 가 같은 주체일 때 그런듯
5. Extension Grants
  - 이건 그냥 알아서 해라 같은데.. RFC 에도 딱히 뭐가 없네</p>
<h3 id="authorization-code-grant"><a class="toclink" href="../../../../2019/08/21/oauth/#authorization-code-grant">Authorization Code Grant</a></h3>
<p>개인적으로 가장 보편적이라 생각하는 <code>Authorization Code Grant</code> 방식에 대해서 설명한다.</p>
<p><img alt="OAuth2.0 Flow" src="/assets/images/posts/2019-08-21-oauth-01.png" /></p>
<blockquote>
<p><a href="https://api.slack.com/docs/oauth">from slack api doc</a></p>
</blockquote>
<p><code>Flow</code> 를 보면 알 수 도 있지만, 간략하게 순서를 정리해 보자면 (<code>Web Application</code> 기준)</p>
<ol>
<li><code>OAuth 2.0</code> 의 방식으로 <code>API Service</code> 를 제공하는 서비스에 가입하여 본인이 개발할 <code>Web Application</code> 을 등록한다.</li>
<li><code>Client ID</code>, <code>Client Secret</code> 을 발급 받고, 본인이 개발할 <code>Web Application</code> 의 <code>Callback URL</code> 을 등록한다.</li>
<li><code>Access Token</code> 을 <code>OAuth 2.0 Flow</code> 에 따라서 발급받는 <code>Web Application</code> 기능을 추가한다.</li>
<li><code>OAuth 2.0 Flow</code> 를 따라 <code>Web Application</code> 에서 <code>Acess Token</code> 을 발급 받는다.</li>
<li><code>Acess Token</code> 으로 <code>Resource</code> 에 접근한다.</li>
</ol>
<p>Naver, Facebook, Instagram, Google+ 등과 라이브러리 없이 연동을 해 보았다. 약간씩 파라미터가 다르지만 대동소이하다. 예제는 Naver.</p>
<h4 id="constants-class"><a class="toclink" href="../../../../2019/08/21/oauth/#constants-class">설정 값을 저장할 <code>Constants</code> class.</a></h4>
<pre><code class="language-java">package util;

import io.netty.handler.codec.http.HttpMethod;

public class Constants {
    public enum OAUTH2_CLIENT {
        NAVER(
            /* auth uri     */ &quot;https://nid.naver.com/oauth2.0/authorize&quot;
            /* auth method  */, HttpMethod.POST
            /* token uri    */, &quot;https://nid.naver.com/oauth2.0/token&quot;
            /* token method */, HttpMethod.POST
            /* resource uri           */, &quot;https://openapi.naver.com/v1/nid/me&quot;
            /* resource method        */, HttpMethod.POST
            /* resource header keys   */, new String[] {&quot;Authorization&quot;}
            /* resource header values */, new String[] {&quot;Bearer &quot;}
            /* client id     */, &quot;MY_CLIENT_ID&quot;
            /* client secret */, &quot;MY_CLIENT_SECRET&quot;
            /* callback uri  */, &quot;MY_CALLBACK_URL&quot;
        ),
        ;
        private String authUri;
        private HttpMethod authPreferedMethod;
        private String tokenUri;
        private HttpMethod tokenPreferedMethod;
        private String resourceServerUrl;
        private HttpMethod resourceServerPreferedMethod;
        private String[] resourceHeaderKey;
        private String[] resourceHeaderValue;
        private String clientId;
        private String clientSecret;
        private String callbackUri;
        public String getAuthUri() { return this.authUri; }
        public HttpMethod getAuthPreferedMethod() { return this.authPreferedMethod; }
        public String getTokenUri() { return this.tokenUri; }
        public HttpMethod getTokenPreferedMethod() { return this.tokenPreferedMethod; }
        public String getResourceServerUrl() { return this.resourceServerUrl; }
        public HttpMethod getResourceServerPreferedMethod() { return this.resourceServerPreferedMethod; }
        public String[] getResourceHeaderKeys() { return this.resourceHeaderKey; }
        public String[] getResourceHeaderValues() { return this.resourceHeaderValue; }
        public String getClientId() {return this.clientId; }
        public String getClientSecret() { return this.clientSecret; }
        public String getCallbackUri() { return this.callbackUri; }
        @Override
        public String toString() { return &quot;DO NOT USE DEFAULT TOSTRING&quot;; }
        private OAUTH2_CLIENT(
                String authUri
                , HttpMethod authPreferedMethod
                , String tokenUri
                , HttpMethod tokenPreferedMethod
                , String resourceServerUrl
                , HttpMethod resourceServerPreferedMethod
                , String[] resourceHeaderKey
                , String[] resourceHeaderValue
                , String clientId
                , String clientSecret
                , String callbackUri
        ) {
            this.authUri = authUri;
            this.authPreferedMethod = authPreferedMethod;

            this.tokenUri = tokenUri;
            this.tokenPreferedMethod = tokenPreferedMethod;

            this.resourceServerUrl = resourceServerUrl;
            this.resourceServerPreferedMethod = resourceServerPreferedMethod;
            this.resourceHeaderKey = resourceHeaderKey;
            this.resourceHeaderValue = resourceHeaderValue;

            this.clientId = clientId;
            this.clientSecret = clientSecret;
            this.callbackUri = callbackUri;
        }
    }//END OF ENUM
}//END OF CLASS
</code></pre>
<h4 id="access-token-testauthfacebookcontroller-class"><a class="toclink" href="../../../../2019/08/21/oauth/#access-token-testauthfacebookcontroller-class">인증과 인가를 거쳐 <code>Access Token</code> 발급을 위한 <code>TestAuthFacebookController</code> class</a></h4>
<pre><code class="language-java">package controller;

import java.io.UnsupportedEncodingException;
import java.math.BigInteger;
import java.net.URLEncoder;
import java.nio.charset.Charset;
import java.security.SecureRandom;
import java.util.Map;

import javax.servlet.http.HttpServletResponse;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import com.fasterxml.jackson.databind.ObjectMapper;

import util.Constants.OAUTH2_CLIENT;
import util.HttpUtils;

@Controller
public class TestAuthFacebookController {

    private static final Logger logger = LoggerFactory.getLogger(TestAuthFacebookController.class);
    public static String storedState = &quot;&quot;;

    @RequestMapping(value=&quot;oauth/facebook/init&quot;, method=RequestMethod.GET)
    public ModelAndView oAuth2TestFacebookInit(HttpServletResponse httpServletResponse) throws UnsupportedEncodingException {
        String stateToken = new BigInteger(130, new SecureRandom()).toString(32);
        logger.debug(&quot;stateToken : &quot; + stateToken);
        TestAuthFacebookController.storedState = stateToken;
        String redirectUrl = OAUTH2_CLIENT.FACEBOOK.getAuthUri()
                + &quot;?client_id=&quot; + OAUTH2_CLIENT.FACEBOOK.getClientId()
                + &quot;&amp;response_type=code&quot;
                + &quot;&amp;redirect_uri=&quot; + URLEncoder.encode(OAUTH2_CLIENT.FACEBOOK.getCallbackUri(), Charset.forName(&quot;UTF-8&quot;).toString())
                + &quot;&amp;state=&quot; + stateToken
                + &quot;&amp;scope=public_profile email manage_pages&quot;;
        return new ModelAndView(&quot;redirect:&quot; + redirectUrl);
    }//END OF FUNCTION

    @RequestMapping(value=&quot;oauth/facebook/callback&quot;, method=RequestMethod.GET)
    public String oAuth2TestFacebookCallback(@RequestParam Map&lt;String,Object&gt; map) throws Exception {
        String recvState = (String) map.get(&quot;state&quot;);
        logger.debug(&quot;recv state : &quot; + recvState);
        String recvCode = (String) map.get(&quot;code&quot;);
        logger.debug(&quot;oAuth2TestFacebookCallback recv code : &quot; + recvCode);
        if(TestAuthFacebookController.storedState.equals(recvState)) {
            String paramStr = &quot;&quot;
                + &quot;client_id=&quot; + OAUTH2_CLIENT.FACEBOOK.getClientId()
                + &quot;&amp;client_secret=&quot; + OAUTH2_CLIENT.FACEBOOK.getClientSecret()
                + &quot;&amp;code=&quot; + recvCode
                + &quot;&amp;redirect_uri=&quot; + OAUTH2_CLIENT.FACEBOOK.getCallbackUri();

            ObjectMapper mapper = new ObjectMapper();
            String jsonInString = HttpUtils.sendAndRecv(
                OAUTH2_CLIENT.FACEBOOK.getTokenUri()
                , OAUTH2_CLIENT.FACEBOOK.getTokenPreferedMethod()
                , paramStr
            );

            logger.debug(&quot;AuthorizationServer recv : &quot; + jsonInString);

        } else {
            throw new Exception(&quot;&quot;);
            //401 unauthorized
        }
        return &quot;main&quot;;
    }//END OF FUNCTION

}//END OF CLASS

</code></pre>
<p>참고
- <a href="https://d2.naver.com/helloworld/24942">Naver - OAuth와 춤을</a></p>
<h3 id="facebook-api-"><a class="toclink" href="../../../../2019/08/21/oauth/#facebook-api-">Facebook API - 로그인 플로 직접 빌드</a></h3>
<p><a href="https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow#token">공식문서</a></p>
<h4 id="url"><a class="toclink" href="../../../../2019/08/21/oauth/#url">로그인 대화 상자 호출 및 리디렉션 URL 설정</a></h4>
<p>클라이언트 앱(서버)에서 페이스북 로그인 화면으로 리디렉션 한다.<br />
로그인 화면에서 사용자(Resource Owner)가 응답을 했을 경우, 되돌아올 클라이언트 앱의 리디렉션 URL (페이스북 앱 관리 페이지에서 미리 설정된 URL 과 같아야함) 과 CSRF 를 위한 문자열 <code>state</code> 을 설정해 준다.</p>
<pre><code>https://www.facebook.com/v4.0/dialog/oauth?
  client_id={app-id}
  &amp;redirect_uri={redirect-uri}
  &amp;state={state-param}
</code></pre>
<ul>
<li><code>client_id</code> : 페이스북 앱 관리 페이지에서 등록한 클라이언트 앱의 발급받은 ID</li>
<li><code>redirect_uri</code> : 사용자가 로그인 후, 권한승인을 했을 때 리디렉션될 클라이언트 앱의 URI</li>
<li><code>state</code> : 아래 네 단계의 flow 를 거치면서 위변조를 막기위해 클라이언트 앱이 1 단계에서 만들어서 4. 단계에서 돌려 받는 문자열.</li>
<li>클라이언트 앱</li>
<li>사용자 로그인</li>
<li>권한서버</li>
<li>클라이언트 앱</li>
<li><code>response_type</code> : 클라이언트 앱으로 리디렉션할 때 포함된 응답 데이터가 URL 매개변수인지 아니면 프래그먼트인지 결정하는 옵션</li>
<li><code>code</code> : 응답 데이터는 URL 매개변수, 기본값</li>
<li>... 뭐가 더 있음. 하지만 관심이 없으므로 생략.</li>
</ul>
<p>그럼 사용자는 페이스북 로그인 화면을 보게되고, 로그인 후 해당 클라이언트 앱에서 사용할 수 있는 권한을 선택한 뒤, 승인 여부를 선택한다. 그러면 기존에 설정된 클라이언트 앱의 리디렉션 URL 을 호출해 준다.</p>
<h4 id="_3"><a class="toclink" href="../../../../2019/08/21/oauth/#_3">로그인 대화 상자 응답 처리</a></h4>
<p>위에서 <code>response_type</code> 을 <code>code</code> 로 했기 때문에, <code>access token</code> 과 교환 할 수 있는 <code>code</code> 와 클라이언트 앱에서 생성한 <code>state</code> 를 돌려 받는다. <code>state</code> 가 생성했던 값과 같은지 확인 한 다음,  <code>code</code> 를 <code>access token</code> 으로 교환한다.</p>
<pre><code>GET https://graph.facebook.com/v4.0/oauth/access_token?
   client_id={app-id}
   &amp;redirect_uri={redirect-uri}
   &amp;client_secret={app-secret}
   &amp;code={code-parameter}
</code></pre>
<ul>
<li><code>client_id</code> : 페이스북 앱 관리 페이지에서 등록한 클라이언트 앱의 발급받은 ID</li>
<li><code>redirect_uri</code> : OAuth 로그인 프로세스를 시작할 때 사용한 원래 <code>request_uri</code></li>
<li><code>client_secret</code> : 페이스북 앱 관리 페이지에서 등록한 클라이언트 앱의 발급받은 Secret</li>
<li><code>code</code> : 전달 받은 <code>code</code></li>
</ul>
<p>위와 같이 요청을 하면, 아래와 같이 응답을 받을 수 있다.</p>
<pre><code class="language-json">{
  &quot;access_token&quot;: {access-token},
  &quot;token_type&quot;: {type},
  &quot;expires_in&quot;:  {seconds-til-expiration}
}
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-19 00:00:00+00:00">August 19, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              6 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="https-tls-ssl"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/">HTTPS, TLS, SSL, 전자서명</a></h2>
<blockquote>
<p>나는 그냥 HTTPS 만 알고싶은데 왜 하나만 알면 안되는거야 행복할수가업서...ㅠㅠ</p>
</blockquote>
<p><img src="#" post-src="2019-08-19-https-ssl-tls.jpg" /></p>
<h3 id="https-ssl-tls"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/#https-ssl-tls">HTTPS 와 SSL, TLS 그게 다 뭐지?</a></h3>
<p>HTTP 는 <code>HyperText Transfer Protocol</code> 이다.  웹상에서 정보를 주고 받기 위한 프로토콜이다.<br />
HTTPS 는 <code>HyperText Transfer Protocol over Secure Socket Layer</code> 이다. 즉, SSL 위에서 동작하는 HTTP 인것이다.<br />
그럼 SSL 은 뭐냐. SSL 은 <code>Secure Socket Layer</code> 이다.<br />
그럼 TLS 는 또 뭐냐. TLS 는 <code>Transport Layer Security</code> 이다.</p>
<blockquote>
<p>넷스케이프 커뮤니케이션스사가 개발한 SSL(Secure Sockets Layer)에 기반한 기술로, 국제 인터넷 표준화 기구에서 표준으로 인정받은 프로토콜이다. 표준에 명시된 정식 명칭은 TLS지만 아직도 SSL이라는 용어가 많이 사용되고 있다. <a href="https://namu.wiki/w/TLS">출처</a></p>
</blockquote>
<p>SSL 기반으로 TLS 가 표준으로 명시되었지만(정확히는 <code>SSL 3.0</code> 기반으로 <code>TLS 1.0</code> 을 만듬), 그냥 SSL 이란 용어를 혼용해서 사용하고 있는 것 같다.</p>
<h4 id="tls"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/#tls">TLS 의 순서</a></h4>
<blockquote>
<p>사전작업
1. 서버에서 private key, public key 를 만든다
2. 만들어진 public key 와 서버의 몇몇 정보를 CA 에 제출한다.
3. 서버의 public key 와 인증기관의 정보를 담아 인증서에 담고, 이 모든 정보를 hash 한 다음 CA 의 비밀키로 암호화 한 값을 추가한다. (전자서명)
4. CA 로부터 발급받은 인증서를 서버에 세팅한다.
1. <strong>클라이언트에서 서버에 ClientHello 메시지를 보낸다.</strong> 여기에는 클라이언트에서 가능한 TLS 버전, 서버 도메인, 세션 식별자, 암호 설정 등의 정보가 포함된다.
2. 클라이언트의 메시지를 받은 <strong>서버는 ServerHello 메시지를 클라이언트에게 보낸다.</strong> 여기에는 ClientHello 메시지의 정보 중 서버에서 사용하기로 선택한 TLS 버전, 세션 식별자, 암호 설정 등의 정보가 포함된다.
3. <strong>서버가 클라이언트에 Certificate 메시지를 보낸다.</strong> 여기에는 (사전작업에서 만든)서버의 인증서가 들어간다. 이 인증서는 별도의 인증 기관에서 발급받은 것이며, 서버가 신뢰할 수 있는 자임을 인증한다. 전송이 끝나면 ServerHelloDone 메시지를 보내 끝났음을 알린다.
4. <strong>클라이언트는 서버에서 받은 인증서를 검증한다.</strong> 인증서의 유효 기간이 만료되지 않았는지, 그 인증서가 해당 서버에게 발급된 인증서가 맞는지 등을 확인한다. 인증서를 신뢰할 수 있다고 판단하였다면 다음 단계로 넘어간다.
  보통 브라우저에는 유명한 CA 들의 공개키를 미리 가지고 있다.
  CA 의 공개키로 인증서의 전자서명 (암호화된 hash 값) 을 복호화하여 위변조되지 않았음을 확인한다.
  검증이후 인증서에 담겨있는 서버의 public key 를 획득한다.
5. <strong>클라이언트는</strong> 임의의 pre-master secret을 생성한 뒤, 서버가 보낸 인증서에 포함된 공개 키를 사용해 암호화한다. 이렇게 <strong>암호화된 pre-master secret을</strong> ClientKeyExchange 메시지에 포함시켜 <strong>서버에 전송한다.</strong>
6. <strong>서버는</strong> 전송받은 정보를 복호화하여 pre-master secret을 알아낸 뒤, 이 정보를 사용해 master secret을 생성한다. 그 뒤 master secret에서 <strong>세션 키를 생성</strong>해내며, 이 세션 키는 앞으로 서버와 클라이언트 간의 통신을 암호화하는데 사용할 것이다. 물론 <strong>클라이언트 역시</strong> 자신이 만들어낸 pre-master secret을 알고 있으므로, 같은 과정을 거쳐 <strong>세션 키를 스스로 만들 수 있다.</strong>
7. 이제 <strong>서버와 클라이언트는 각자 동일한 세션 키를 가지고 있으며, 이를 사용해 대칭 키 암호를 사용하는 통신을 할 수 있다.</strong> 따라서 우선 서로에게 ChangeCipherSpec 메시지를 보내 앞으로의 모든 통신 내용은 세션 키를 사용해 암호화해 보낼 것을 알려준 뒤, Finished 메시지를 보내 각자의 핸드셰이킹 과정이 끝났음을 알린다.
  이 과정에서 디피헬먼 알고리즘이 사용된다
8. 이제 서버와 클라이언트 간에 보안 통신이 구성된다. <a href="https://namu.wiki/w/TLS">출처</a></p>
<p>음 좀 더 자세히 알고 싶지만 가성비가 격하게 떨어질 것 같은 느낌..</p>
</blockquote>
<h3 id="_1"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/#_1">전자서명이 뭐지?</a></h3>
<p>먼저 서명에 대한 정의.</p>
<blockquote>
<p>서명(署名, 문화어: 수표)은 누군가의 이름, 가명, 또는 누군가가 문서에 기록했다는 증거, 자기 동일성을 위한 표시로 손으로 쓴 것을 말한다. 사인(sign)이라고도 한다.<br />
(A가 B에게 어떤 문서 D를 건네 줬을때, D를 A가 기록한 뒤로 누군가 변조하지 않았다는 증거이다.)</p>
</blockquote>
<p>전자서명에 대해서 알아보기 전에, 어떤 데이터(B1)를 배포하는 과정을 생각해 보자.<br />
데이터를 배포할 때, 받는 쪽에서 데이터가 변조되지 않았음을 확인하기 위해 해싱을 사용한다.
데이터를 해싱하여 해시값(H1)을 얻고 이를 배포자의 암호화키(KeyE)로 암호화 하여 서명(S)이란 것을 만든다.
그리고 데이터(B1), 서명(S), 그리고 배포자의 복호화키(KeyD) 를 배포셋(C1)으로 만들어 배포한다.</p>
<p>배포하는 과정과 배포받은 사용자가 이를 검증하는 과정은 아래와 같다.</p>
<pre><code>//배포과정
Hash(B1) =&gt; H1;                 // 배포데이터(B1)을 해시 함수에 입력하여 해시값(H1)을 얻음  
Encrypt(KeyE, H1) =&gt; S;         // 해시값(H1)을 개인키(KeyE)로 암호화하여 서명(S)을 얻음  
C1 = {B1, S, KeyD}              // 배포데이터(B1), 서명(S), 공개키(KeyD)를 묶어서 배포셋(C1, 코드사인 바이너리) 생성

//배포검증과정
C1 =&gt; B1, S, KeyD;                            // 다운로드 한 배포셋(C1)을 배포데이터(B1), 서명(S), 공개키(KeyD)로 분리  
Decrypt(KeyD, S) =&gt; H1;                       // 서명(S)을 공개키(KeyD)로 복호화하여 해시값(H1)을 얻음  
Hash(B1) =&gt; H1';                              // 배포데이터(B1)을 해시 함수에 입력하여 해시값(H1')을 얻음  
If H1 == H1', Execute C1 =&gt; Very Good!        // 두 해시값이 일치하는 것을 확인
</code></pre>
<p>위의 과정에서 해커가 데이터(B1) 을 다른 데이터(B2) 로 바꿔서 <code>C1 =&gt; {B2, S, KeyD}</code> 로 배포하는 과정은 막을 수 있어도,</p>
<blockquote>
<p>배포받은 사용자가 KeyD 로 S 를 복호화 하면 H1' 를 구할 수 있고, B2 를 해싱하면 H1 이 나오기 때문에 복호화 하여 구한 H1' 과 직접 해싱한 H1 을 비교하면 변조유무를 확인할 수 있기 때문이다.</p>
</blockquote>
<p>B2 로 부터 새로운 해쉬 값과 새로운 비대칭키를 만들어 배포하는 과정은 검증할 수가 없다.</p>
<p>따라서. 공인인증기관이라는 제 3의 검증기관이 필요하다. 이때 사용하는 것이 인증서이다.</p>
<pre><code>INFO_LIST = {
  일련번호,
  ...,
  발급자(인증기관),
  주체(발급대상, 데이터를 배포하고자 하는 주체),
  주체의 공개키,
  ...,
  확장
}
Hash(INFO_LIST) =&gt; HASH1;   // 필요한 정보(INFO_LIST)들을 해시하여 해시값(HASH1)을 구한다.
Encrypt(CKeyE, HASH1) =&gt; CS // 인증기관의 개인키(CKeyE)로 해시값(HASH1)을 암호화 하여 인증기관의 서명(CS)을 구한다.
CT = { INFO_LIST, CS }      // 인증서(CT)는 필요한 정보(INFO_LIST)와 인증기관의 서명(CS)으로 구성된다.
</code></pre>
<p>그럼 인증기관을 포함한 배포과정을 다시 작성해 보자.</p>
<pre><code>C1 = { B1, CT : { INFO_LIST, CS }, S } // 배포셋(C1)은 배포데이터(B1)와 인증서(CT)와 배포자의 서명(S)로 구성되어 있다.
C1 =&gt; B1, CT : { INFO_LIST, CS }, S    // 배포받은 사용자는 배포셋(C1)을 분리한다.
CT =&gt; INFO_LIST, CS                    // 인증서(CT) 를 분리한다.
INFO_LIST =&gt; ..., KeyD, ...            // 필요한 정보(INFO_LIST)에서 배포자의 공개키(KeyD) 를 분리한다.
Decrypt(KeyD, S) =&gt; H1                 // 배포자의 공개키(KeyD) 로 배포자의 서명(S)를 복호화 하여 해시값(H1)을 구한다.
Hash(B1) =&gt; H1'                        // 배포데이터(B1)을 직접 해시하여 해시값(H1')을 구한다.
If H1 == H1', Checked                  // 복호화한 해시값(H1)과 직접 해시한 해시값(H1')이 같은지 비교한다. 여기까지는 이전의 인증과정과 별반 다르지 않다.

Check(INFO_LIST)                             // 필요한 정보(INFO_LIST)에서 배포자에 대한 정보를 확인한다.
Decrypt(CKeyD, CS) =&gt; HASH1                  // 인증기관의 공개키(CKeyD, 뜬금없이 나온 인증기관의 공개키는 이미 가지고 있다고 가정한다.)로 인증기관의 서명(CS)를 복호화 하여 해시값(HASH1)을 구한다.
Hash(INFO_LIST) =&gt; HASH1'                    // 필요한 정보(INFO_LIST)를 직접 해시하여 해시값(HASH1')를 구한다.
If HASH1 == HASH1', Execute C1 =&gt; Very Good! // 두 해시값이 일치한다면, 필요한 정보(INFO_LIST)들은 변조된적이 없는 것이고, 배포자의 공개키(KeyD) 역시 변조되지 않았음을 증명한다.
</code></pre>
<p>그럼 위에서 뜬금없이 나온 인증기관의 공개키(CKeyD) 는 어디서 인증할 것인가? 배포자의 공개키(KeyD)를 인증한 방법으로 상위 기관의 인증서로 인증을 한다. 이렇게 상위 기관의 인증서로 하위 인증기관의 공개키를 검증하는 것을 인증서 체인이라고 하고, 인증서 체인을 따라올라가다보면 최상위 인증기관(Root CA, 스스로를 인증함)을 만날 수 있는데, 최상위 인증서는 무조건 신뢰한다고 가정하고 이 모든 인증을 진행하는 것이다.</p>
<p>아래와 같이 최상위 인증서의 발급대상과 발급자가 같다.</p>
<p><img src="#" post-src="2019-08-19-https-ssl-tls-01.PNG" /></p>
<blockquote>
<p>긴 여정 이었다. 휴!</p>
</blockquote>
<h4 id="tls_1"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/#tls_1">TLS 관련 확장자들</a></h4>
<pre><code class="language-yaml">.pem :
  - X.509 v3 파일의 한 형태
  - Privacy Enhanced Mail 은 Base64인코딩된 ASCII text file.
  - 원래는 secure email에 사용되는 인코딩 포멧이었는데 더이상 email쪽에서는 잘 쓰이지 않고 인증서 또는 키값을 저장하는데 많이 사용.
  - -----BEGIN XXX----- , -----END XXX----- 로 묶여있는 text file을 보면 이 형식으로 인코딩. (담고있는 내용에 따라 XXX 위치에 CERTIFICATE, RSA PRIVATE KEY 등을 사용)
  - 인증서(Certificate = public key), 비밀키(private key), 인증서 발급 요청을 위해 생성하는 CSR (certificate signing request) 등을 저장하는데 사용.

.crt/.cer : 인증서를 나타내는 확장자. (cer은 MS 제품군에서 많이 사용, crt는 unix, linux 계열에서 많이 사용.)

.key : 개인 또는 공개 PKCS#8 키를 의미
</code></pre>
<h4 id="_2"><a class="toclink" href="../../../../2019/08/19/https-tls-ssl-%EC%A0%84%EC%9E%90%EC%84%9C%EB%AA%85/#_2">인증서가 한개가 아니야?</a></h4>
<p><code>DV(Domain Validation)</code> 인증서는 인증서를 발급한 요청자가 그 도메인의 소유주가 맞는지만을 확인하여 발급을 하기 때문에, 비용만 내면 아무나 인증서를 발급 받을 수 있다. 이런 문제를 해결하기 위해 <code>EV-SSL</code> 이 나왔다.</p>
<p><code>EV-SSL</code> 은 공신력 있는 인증 기관에서 더욱 엄격한 심사 기준으로 발급한 <code>EV(Extended Validation)</code> 인증서를 사용하여 보안을 강화한 프로토콜이다. 상위</p>
<blockquote>
<p>EV 인증서를 발급 받기 위해서는 까다로운 인증절차 및 신원보증 등이 확인되어야만 구축이 가능하기 때문에 피싱(Phishing)과 파밍(Pharming) 등의 공격으로부터 엔드 유저와 일반 사용자를 보호할 수 있습니다.</p>
<p>어찌 선점 고인물 같은데</p>
</blockquote>
<p>출처
- <a href="https://ko.wikipedia.org/wiki/%EC%84%9C%EB%AA%85">서명</a>
- <a href="https://www.letmecompile.com/certificate-file-format-extensions-comparison/">인증서 파일 형식 및 확장자의 차이점 비교 설명 (Certificate file format &amp; extensions)</a>
- <a href="https://d2.naver.com/helloworld/744920">네이버 애플리케이션의 전자 서명 원리</a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-19 00:00:00+00:00">August 19, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="tomcat-ssl"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/">TOMCAT 에 SSL 적용</a></h2>
<blockquote>
<p>아래 내용을 다시 해보려니 뭔가 안되서 다시 작성합니다. <a href="{{ site.url }}/apply-tls-to-tomcat-custom-openssl-certification2/">여기로</a></p>
<p>apache-tomcat-9.0.14 에 적용했다.</p>
</blockquote>
<h4 id="1-openssl"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#1-openssl">1. OpenSSL 프로그램을 다운받자</a></h4>
<p><a href="https://sourceforge.net/projects/openssl/">OpenSSL</a> 그냥 다운 받아서 압축 풀면 됨..</p>
<h4 id="2"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#2">2. 개인키를 만들자</a></h4>
<p>다운받은 <code>OpenSSL</code> 을 실행시켜서 아래 명령어를 입력해 준다.</p>
<pre><code class="language-shell"># 이렇게 하면 password 가 있는 개인키가 나온다.
genrsa -des3 -out &lt;MY PRIVATE KEY FILE NAME&gt; 2048

# EXAMPLE
OpenSSL&gt; genrsa -des3 -out delete.me.plz.private.key 2048
Generating RSA private key, 2048 bit long modulus
............................+++
.........................................+++
unable to write 'random state'
e is 65537 (0x10001)
Enter pass phrase for delete.me.plz.private.key: &lt;TYPE MY PASSWORD&gt;
Verifying - Enter pass phrase for delete.me.plz.private.key: &lt;TYPE MY PASSWORD&gt;

# 비밀번호가 없는 개인키 만들기
genrsa -out &lt;MY PRIVATE KEY FILE NAME&gt; 2048
</code></pre>
<h4 id="3"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#3">3. 개인키를 만들었으면 대응되는 공개키를 만들자.</a></h4>
<pre><code class="language-shell">rsa -in &lt;MY PRIVATE KEY FILE NAME&gt; -pubout -out &lt;MY PUBLIC KEY FILE NAME&gt;

# EXAMPLE
OpenSSL&gt; rsa -in delete.me.plz.private.key -pubout -out delete.me.plz.public.key
Enter pass phrase for delete.me.plz.private.key: &lt;TYPE MY PASSWORD&gt;
writing RSA key
</code></pre>
<h4 id="4-csr"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#4-csr">4. <code>CSR</code> 인증요청서를 만들자.</a></h4>
<p><code>CSR</code> 은 <code>Certificate Signing Request</code> 로 <code>SSL</code> 서버를 운영하는 회사의 정보를 암호화하여 인증기관으로 보내 인증서를 발급받게 하는 신청서이다.</p>
<pre><code class="language-shell">req -new -key &lt;MY PRIVATE KEY FILE NAME&gt; -out &lt;MY CSR FILE NAME&gt;

# EXAMPLE
OpenSSL&gt; req -new -key delete.me.plz.private.key -out delete.me.plz.csr
Unable to load config info from C:/OpenSSL/openssl.cnf
error in req
</code></pre>
<p>근데 저렇게 나와서 찾다보니 옵션을 주면 된단다.
참고로 처음 기동할때도 이런 메세지를 보여줬는데..</p>
<pre><code>WARNING: can't open config file: C:/OpenSSL/openssl.cnf
</code></pre>
<p>아무튼...</p>
<pre><code class="language-shell">req -config &lt;LOCATION OF openssl.cnf FILE&gt; -new -key &lt;MY PRIVATE KEY FILE NAME&gt; -out &lt;MY CSR FILE NAME&gt;

# EXAMPLE
OpenSSL&gt; req -config ./openssl.cnf -new -key delete.me.plz.private.key -out delete.me.plz.csr
Enter pass phrase for delete.me.plz.private.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:KR
State or Province Name (full name) [Some-State]:Seoul
Locality Name (eg, city) []:Seoul
Organization Name (eg, company) [Internet Widgits Pty Ltd]:HARM
Organizational Unit Name (eg, section) []:harm
Common Name (e.g. server FQDN or YOUR name) []:epu baal
Email Address []:herdin86@gmail.com

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:1234
An optional company name []:harm
</code></pre>
<p>저렇게 하면 된다.<br />
저런 뒤, 만들어진 <code>CSR</code> 파일을 열어보면</p>
<pre><code>-----BEGIN CERTIFICATE REQUEST-----
어쩌구저쩌구알수없는암호화문자열들...
-----END CERTIFICATE REQUEST-----
</code></pre>
<p>위와 같은 양식의 요청서를 볼 수 있다. 여기까지했으면, <code>CA(Certificate Authority)</code> 인증 기관에 요청하여 <code>CRT(CeRTificate)</code> 파일을 받을 수 있다.</p>
<blockquote>
<p>뭐 메일로 받는다던데.. 안해봐서..</p>
</blockquote>
<p>하지만 요청하고 다시 회신받고 귀찮고 난 그냥 로컬서버에 tomcat 이 https 요청을 받아주기만 할 수 있으면 되기 때문에 사설 CA 를 만들고 진행한다.</p>
<h4 id="5-root-ca"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#5-root-ca">5. root CA 만들기</a></h4>
<p>인증서에 서명을 할 root CA 를 만든다.</p>
<pre><code class="language-shell">genrsa -aes256 -out &lt;ROOT CA FILE NAME&gt; 2048

# EXAMPLE
OpenSSL&gt; genrsa -aes256 -out rootCA.key 2048
Generating RSA private key, 2048 bit long modulus
........................................................+++
.....................................................................+++
e is 65537 (0x10001)
Enter pass phrase for rootCA.key:
Verifying - Enter pass phrase for rootCA.key:
</code></pre>
<h4 id="6-root-ca-csr"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#6-root-ca-csr">6.  root CA 사설 CSR 생성하기</a></h4>
<p>위에서 만든 root CA 를 이용하여 사설 CSR 을 만든다.</p>
<blockquote>
<p>위에서 CSR 만들었는데 왜 또 만들지? 잘모르겠지만 root CA 의 CSR 과 개인 CSR 이 둘다 필요한 것 같다. 확장자는 중요하지 않은 것 같다.</p>
</blockquote>
<pre><code class="language-shell">req -x509 -new -nodes -key &lt;ROOT CA FILE NAME&gt; -days 3650 -out &lt;ROOT CA CSR FILE NAME&gt;

# EXAMPLE
OpenSSL&gt; req -config ./openssl.cnf -x509 -nodes -key rootCA.key -days 3650 -out rootCSR.pem
Enter pass phrase for rootCA.key:
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:KR
State or Province Name (full name) [Some-State]:Seoul
Locality Name (eg, city) []:Seoul
Organization Name (eg, company) [Internet Widgits Pty Ltd]:HARM
Organizational Unit Name (eg, section) []:harm
Common Name (e.g. server FQDN or YOUR name) []:epu baal
Email Address []:herdin86@gmail.com
</code></pre>
<h4 id="7-crt"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#7-crt">7. CRT 인증서 생성하기</a></h4>
<pre><code class="language-shell">
x509 -req -in &lt;MY CSR FILE NAME&gt; -CA &lt;ROOT CA CSR FILE NAME&gt; -CAkey &lt;ROOT CA FILE NAME&gt; -CAcreateserial -out &lt;MY CRT FILE NAME&gt; -days 3650

x509 -req -in private.csr -CA rootCSR.pem -CAkey rootCA.key -CAcreateserial -out private.crt -days 3650
</code></pre>
<h4 id="8-tomcat"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#8-tomcat">8. tomcat 에 적용하기 위해 형식 변경</a></h4>
<pre><code class="language-shell">pkcs12 -export -in &lt;MY CRT FILE NAME&gt; -inkey &lt;MY PRIVATE KEY FILE NAME&gt; -out &lt;MY PKCS12 FILE NAME FOR TOMCAT&gt; -name &lt;NAME-여긴 뭘적는건지 모르겠다&gt;

pkcs12 -export -in private.crt -inkey private.key -out .keystore -name tomcat
</code></pre>
<h4 id="9-tomcat-https"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#9-tomcat-https">9. tomcat 에 HTTPS 커넥터 적용</a></h4>
<p>tomcat <code>server.xml</code> 에 아래 내용을 추가한다. 대소문자를 잘 입력하도록하자.
다른 블로그에서 참고하다가 <code>attribute</code> 의 대소문자 때문에 안되서 몇시간 낭비했다.</p>
<pre><code class="language-xml">&lt;Connector port=&quot;8443&quot; protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot;
        maxThreads=&quot;150&quot;
        scheme=&quot;https&quot;
        secure=&quot;true&quot;
        SSLEnabled=&quot;true&quot;

        keystorePass=&quot;&lt;MY PKCS12 FILE EXPORT PASSWORD&gt;&quot;
        keystoreFile=&quot;&lt;MY PKCS12 FILE NAME FOR TOMCAT&gt;&quot;

        clientAuth=&quot;false&quot;
        sslProtocol=&quot;TLS&quot;
/&gt;
</code></pre>
<h4 id="10"><a class="toclink" href="../../../../2019/08/19/tomcat-%EC%97%90-ssl-%EC%A0%81%EC%9A%A9/#10">10. 확인</a></h4>
<p><code>https://MY-DOMAIN:8443</code> 에 접속하여 확인해 보자.</p>
<p>끝.</p>
<p>연관 포스트들
- <a href="{{ site.url }}/2019/08/19/https-ssl-tls">HTTPS</a>
- <a href="{{ site.url }}/2019/08/21/encryption">대칭키와 공개키</a></p>
<p>참고 포스트들
- <a href="https://namjackson.tistory.com/24">OpenSSL 을 이용한 SSL 인증서 발급</a>
- <a href="https://namjackson.tistory.com/25">SSL TOMCAT 적용1</a>
- <a href="https://joshuajangblog.wordpress.com/tag/%ED%86%B0%EC%BA%A3-ssl-%EC%84%A4%EC%A0%95%EB%B0%A9%EB%B2%95/">SSL TOMCAT 적용2</a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-16 00:00:00+00:00">August 16, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="grisette-style"><a class="toclink" href="../../../../2019/08/16/grisette-style/">Grisette style</a></h2>
<p><a href="https://en.wikipedia.org/wiki/Grisette_(beer)">Grisette on wiki</a></p>
<p><img alt="grisette" src="/assets/images/posts/2019-08-16-beer-grisette-01.jpg" /></p>
<p><img alt="grisette on menu" src="/assets/images/posts/2019-08-16-beer-grisette-02.jpg" /></p>
<blockquote>
<p><a href="https://www.seoulbrewery.com">서울브루어리 합정점</a> 에서 처음 먹어 본 스타일로 처음보는 스타일이라 직원에게 그리셋이 뭐냐고 했더니 앵무새처럼 그리셋이 그리셋이다 라고 대답해서 당황했던 기억이 난다. 광부의 세종이라고 하면 알아먹었을텐데 세상은 멍청한 사람에게 친절하지 않다.</p>
</blockquote>
<p>프랑스와 벨기에 경계의 광산지대에서 유래된 맥주이다. <code>Grisette</code> 이란 명칭은 <code>little grey one</code> 이라는 해당 지역의 회색 돌 또는 맥주를 서빙하던 여성의 회색 드레스 에서 유래되었다고 한다. 낮은 도수에 라이트바디, 다른 세종처럼 시큼한 맛이다.</p>
<blockquote>
<p>시간이 좀 지난 뒤 쓰는 글이라 기억이 명확하진 않지만, 웰컴썸머그리셋은 풀향이 짙게 났던 것 같다.
미각이 둔해서 섬세하게 느끼지 못하기 때문에 맛이 강하거나 독특하면 기억에 남는다.
직원분들 쿨내가 진동하지만 다시 한번 가서 먹어보고 싶다.</p>
</blockquote>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-16 00:00:00+00:00">August 16, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="facade-pattern"><a class="toclink" href="../../../../2019/08/16/facade-pattern/">Facade pattern</a></h2>
<p>Facade 의 사전적 의미</p>
<blockquote>
<p>파사드(프랑스어: Façade)는 건물의 출입구로 이용되는 정면 외벽 부분을 가리키는 말이다.<br />
한글화하여 순화하려면 '정면'(正面)이 무난할 것으로 여겨진다.
건축에서 파사드의 궁극적 목적은 '소통'이다. 건물의 입면이 다양해지면서 파사드는 건물 외피 전체를 의미하기도 한다.
<a href="https://ko.wikipedia.org/wiki/파사드">wiki</a></p>
</blockquote>
<p>어떤 작업을 할때 작업단위의 일련의 작업을 한다고하면, 일련의 작업을 단순화 시키는 패턴을 의미한다. <a href="https://ko.wikipedia.org/wiki/퍼사드_패턴">좀더 자세하고 명확한 해설은 wiki 로</a></p>
<p>똥을 싸기위해</p>
<ol>
<li>양변기뚜껑을 열고</li>
<li>바지를 내리고</li>
<li>팬티를 내리고</li>
<li>힘을 준다</li>
</ol>
<p>라는 일련의 작업이 있으면 이를</p>
<ol>
<li>똥을 싼다.</li>
</ol>
<p>로 줄이는 것을 말한다.</p>
<p>코드로 보면..</p>
<p>먼저 변기 클래스</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Toilet {
    private Logger logger = LoggerFactory.getLogger(Toilet.class);
    public int openCover(int sequence) throws Exception {
        if(sequence == 0) {
            this.logger.debug(&quot;OPEN COVER&quot;);
        } else {
            throw new Exception(&quot;NO PROPER SEQUENCE&quot;);
        }
        return ++sequence;
    }
}
</code></pre>
<p>바지 클래스</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Pants {
    private Logger logger = LoggerFactory.getLogger(Pants.class);
    public int lower(int sequence) throws Exception {
        if(sequence == 1) {
            this.logger.debug(&quot;LOWER PANTS&quot;);
        } else {
            throw new Exception(&quot;NO PROPER SEQUENCE&quot;);
        }
        return ++sequence;
    }
}
</code></pre>
<p>팬티 클래스</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Underwear {
    private Logger logger = LoggerFactory.getLogger(Underwear.class);
    public int lower(int sequence) throws Exception {
        if(sequence == 2) {
            this.logger.debug(&quot;LOWER UNDERWEAR&quot;);
        } else {
            throw new Exception(&quot;NO PROPER SEQUENCE&quot;);
        }
        return ++sequence;
    }
}
</code></pre>
<p>궁둥이 클래스</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class Ass {
    private Logger logger = LoggerFactory.getLogger(Ass.class);
    public int bigShoot(int sequence) throws Exception {
        if(sequence == 3) {
            this.logger.debug(&quot;POOOOOOOOOOOOOOOO-POOOOOOOOOOOOOOOO-&quot;);
        } else {
            throw new Exception(&quot;NO PROPER SEQUENCE&quot;);
        }
        return ++sequence;
    }
}
</code></pre>
<p>위의 <code>Toilet</code>, <code>Pants</code>, <code>Underwear</code>, <code>Ass</code> class 들은 논리적으로 긴밀하게 연결되어 있다.<br />
순서가 잘못되면 오류가 난다. 위의 4개의 class 를 이용해서 똥을 싸려면.</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import com.harm.unit.Unit;

public class FacadeStudy001 implements Unit {

    @Override
    public Object execute(Object[] obj) throws Exception {
        int sequence = -1;

        sequence = 0;
        sequence = new Toilet().openCover(sequence);
        sequence = new Pants().lower(sequence);
        sequence = new Underwear().lower(sequence);
        sequence = new Ass().bigShoot(sequence);

        return null;
    }
}
</code></pre>
<p>위와 같은 과정을 거쳐야 하지만...<br />
<code>Facade</code> pattern 을 적용한 <code>DoNumberTwo</code> class 를 설계한다면..</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

public class DoNumberTwo {
    private Toilet toilet;
    private Pants pants;
    private Underwear underwear;
    private Ass ass;
    public DoNumberTwo(Toilet toilet, Pants pants, Underwear underwear, Ass ass) {
        this.toilet = toilet;
        this.pants = pants;
        this.underwear = underwear;
        this.ass = ass;
    }
    public void bigShoot(int sequence) throws Exception {
        sequence = this.toilet.openCover(sequence);
        sequence = this.pants.lower(sequence);
        sequence = this.underwear.lower(sequence);
        sequence = this.ass.bigShot(sequence);
    }
}
</code></pre>
<p>아래와 같이 코드가 줄어듬과 동시에 가독성이 좋아지게 된다.</p>
<pre><code class="language-java">package com.harm.unit.pattern.facade;

import com.harm.unit.Unit;

public class FacadeStudy001 implements Unit {

    @Override
    public Object execute(Object[] obj) throws Exception {
        int sequence = -1;

        sequence = 0;
        new DoNumberTwo(new Toilet(), new Pants(), new Underwear(), new Ass()).bigShoot(sequence);

        return null;
    }
}
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-16 00:00:00+00:00">August 16, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="travis-ci-java-8"><a class="toclink" href="../../../../2019/08/16/travis-ci-%EC%97%90%EC%84%9C-java-8-%EC%82%AC%EC%9A%A9/">Travis CI 에서 java 8 사용</a></h2>
<p><code>Travis</code> 를 개인 자바 프로젝트 CI 용도로 사용 중이다.<br />
2019-08-09 까지는 컴파일이 됐는데, 2019-08-14 부터 컴파일 에러가 나는거다.<br />
따로 설정을 바꿔준 적은 없고 그냥 소스만 수정해서 push 했는데..</p>
<pre><code class="language-shell">...
[ERROR] COMPILATION ERROR :
[INFO] -------------------------------------------------------------
[ERROR] /home/travis/build/herdin/SimpleJava/src/main/java/com/harm/unit/xml/jaxb/JaxBStudy001.java:[10,22] package javax.xml.bind does not exist
[ERROR] /home/travis/build/herdin/SimpleJava/src/main/java/com/harm/unit/xml/jaxb/JaxBStudy001.java:[11,22] package javax.xml.bind does not exist
...
</code></pre>
<p>이런 에러가 계속 나고있었다.<br />
뭔 설정문제같은데.. 하면서 헤메다가</p>
<p>회사동료가 jdk 버전 바뀐게 아니냐고 해서 로그를 보니</p>
<pre><code class="language-shell">...
$ javac -J-Xmx32m -version
javac 11.0.2
...
</code></pre>
<p>갑자기 왜 jdk11 로 컴파일을하지....????</p>
<p><a href="https://docs.travis-ci.com/user/languages/java/#overview">문서</a> 를 뒤져보니 간단하게 해결했다.</p>
<p><code>.travis.yml</code> 설정에</p>
<pre><code class="language-yaml">jdk:
  - openjdk8
</code></pre>
<p>추가로 끝..</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-15 00:00:00+00:00">August 15, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="2019-2"><a class="toclink" href="../../../../2019/08/15/2019-%EC%B9%B4%EC%B9%B4%EC%98%A4-%EC%98%A4%ED%94%84%EB%9D%BC%EC%9D%B8-2%EC%B0%A8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EA%B0%9C%EC%9D%B8-%EA%B3%B5%EB%B6%80/">2019 카카오 오프라인 2차 테스트 개인 공부</a></h2>
<blockquote>
<p>카카오에서 <code>Github</code> 에도 올리고 포스트도 올렸으니 막 갖다 써도되것지.......</p>
</blockquote>
<p><a href="https://github.com/kakao-recruit/2019-blind-2nd-elevator">엘레베이터 서버</a>를 실행했더니, 아래와 같은 에러가 난다.</p>
<pre><code class="language-shell">[root@instance-20190319-second example]# python example.py
Token for tester is wYlzh
Traceback (most recent call last):
  File &quot;example.py&quot;, line 114, in &lt;module&gt;
    p0_simulator()
  File &quot;example.py&quot;, line 38, in p0_simulator
    action(token, [{'elevator_id': 0, 'command': 'UP'}, {'elevator_id': 1, 'command': 'ENTER', 'call_ids': [2, 3]}])
  File &quot;example.py&quot;, line 19, in action
    return requests.post(uri, headers={'X-Auth-Token': token}, json={'commands': cmds}).json()
  File &quot;/usr/lib/python2.7/site-packages/requests/models.py&quot;, line 802, in json
    return json.loads(self.text, **kwargs)
  File &quot;/usr/lib64/python2.7/json/__init__.py&quot;, line 338, in loads
    return _default_decoder.decode(s)
  File &quot;/usr/lib64/python2.7/json/decoder.py&quot;, line 366, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File &quot;/usr/lib64/python2.7/json/decoder.py&quot;, line 384, in raw_decode
    raise ValueError(&quot;No JSON object could be decoded&quot;)
ValueError: No JSON object could be decoded
</code></pre>
<p>구글링하니까 <code>requests</code> 모듈이 없나보다..<br />
그래서 없는 애를 설치하려고 보니 <code>python-pip</code> 도 없어서 설치하려 했더니...</p>
<pre><code class="language-shell">[root@instance-20190319-second example]# yum install python-pip
error: rpmdb: BDB0113 Thread/process 25892/140479827851072 failed: BDB1507 Thread died in Berkeley DB library
error: db5 error(-30973) from dbenv-&gt;failchk: BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery
error: cannot open Packages index using db5 -  (-30973)
error: cannot open Packages database in /var/lib/rpm
CRITICAL:yum.main:

Error: rpmdb open failed
</code></pre>
<p>yum install 이 안될땐 <a href="{{ site.url}}/yum-thread-died-in-berkeley-db-library/">이렇게</a> 하면 된다.</p>
<p>암튼 다 깔고 실행하면 되긴하는데... 이러면 <code>python</code> 도 깔아야하고..<br />
테스트 환경은 공짜 <code>GCP</code> 라 자원이 열악한데 이렇게 다 깔면 왠지 싫어서.. <code>Docker</code> 로 실행하려했다.</p>
<p><code>Docker</code> 파일이 있길래 빌드를 했더니 또 안돼...</p>
<blockquote>
<p>글을 쓰기 시작한날이 2019/08/05 이고 지금은 2019/09/05 라.. 기록도 안남아있고 간략하게 남기겠다.</p>
</blockquote>
<p><code>dataset</code> 폴더와 <code>log</code> 폴더가 <code>Docker file context</code> 위치에 없어서 오류가 나서
<code>Dockerfile</code> 위치를 옮기고, <code>dataset</code> 폴더를 복사하고, <code>log</code> 폴더를 만들어준 <a href="https://github.com/herdin/2019-blind-2nd-elevator/tree/develop">Branch</a> 를 <code>Pull request</code> 를 날렸는데, 관심이 없는건지 내가 잘못 고친건지 피드백이 없다..</p>
<blockquote>
<p>헤헤. 뭐 내가 잘 썻으면 됐지.</p>
</blockquote>
<p>아무튼</p>
<p><code>docker run -d -p 8000:8000 --name kakaoelevator epubaal/kakao-2019-offline-test-elevator:0.4</code></p>
<blockquote>
<p>도커이미지도 떠서 허브에 올렸다!!</p>
</blockquote>
<p><img alt="yes" src="/assets/images/posts/kakao-offline-test-elevator-01.PNG" /></p>
<p>짜잔.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <a class="md-pagination__link" href="../2/">2</a> <a class="md-pagination__link" href="../3/">3</a> <span class="md-pagination__current">4</span> <a class="md-pagination__link" href="../5/">5</a> <a class="md-pagination__link" href="../6/">6</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../8/">8</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": [], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": {"Compatibility": "compat", "rabbitmq": "rabbitmq"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.f13b1293.min.js"></script>
      
    
  </body>
</html>