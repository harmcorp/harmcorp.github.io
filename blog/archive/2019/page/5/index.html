
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://harmcorp.github.io/blog/archive/2019/page/5/">
      
      
        <link rel="prev" href="../../../2025/">
      
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.2">
    
    
      
        <title>2019 - HARM CORP</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.d7758b05.min.css">
      
      


  
  
    
    
      
    
    
  
  
  <style>.md-tag.md-tag--rabbitmq{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M23.035 9.601h-7.677a.956.956 0 0 1-.962-.962V.962a.956.956 0 0 0-.962-.956H10.56a.956.956 0 0 0-.962.956V8.64a.956.956 0 0 1-.962.962H5.762a.956.956 0 0 1-.961-.962V.962A.956.956 0 0 0 3.839 0H.959a.956.956 0 0 0-.956.962v22.076A.956.956 0 0 0 .965 24h22.07a.956.956 0 0 0 .962-.962V10.58a.956.956 0 0 0-.962-.98zm-3.86 8.152a1.437 1.437 0 0 1-1.437 1.443h-1.924a1.437 1.437 0 0 1-1.436-1.443v-1.917a1.437 1.437 0 0 1 1.436-1.443h1.924a1.437 1.437 0 0 1 1.437 1.443z"/></svg>');}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2019" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="HARM CORP" class="md-header__button md-logo" aria-label="HARM CORP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HARM CORP
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2019
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="HARM CORP" class="md-nav__button md-logo" aria-label="HARM CORP" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HARM CORP
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    this is blog index!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../2025/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
      
    
  
  
    <li class="md-nav__item">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="../../" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/holidays/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Holidays
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2019">2019</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-15 00:00:00+00:00">August 15, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="bdb1507-thread-died-in-berkeley-db-library"><a class="toclink" href="../../../../2019/08/15/bdb1507-thread-died-in-berkeley-db-library/">BDB1507 Thread died in Berkeley DB library</a></h2>
<p><a href="https://tech.kakao.com/2018/10/23/kakao-blind-recruitment-round-2/">2019 카카오 오프라인 2차 코딩 테스트 해설</a> 을 보고 재밌어보이는데다가, 서버프로그램을 <code>Github</code> 에 올렸다고하여 그대로 <code>fork</code> 해서 실행해보았다.</p>
<p>엘레베이터 서버를 실행하면, 아래와 같은 에러가 난다.</p>
<pre><code class="language-shell">[root@instance-20190319-second example]# python example.py
Token for tester is wYlzh
Traceback (most recent call last):
  File &quot;example.py&quot;, line 114, in &lt;module&gt;
    p0_simulator()
  File &quot;example.py&quot;, line 38, in p0_simulator
    action(token, [{'elevator_id': 0, 'command': 'UP'}, {'elevator_id': 1, 'command': 'ENTER', 'call_ids': [2, 3]}])
  File &quot;example.py&quot;, line 19, in action
    return requests.post(uri, headers={'X-Auth-Token': token}, json={'commands': cmds}).json()
  File &quot;/usr/lib/python2.7/site-packages/requests/models.py&quot;, line 802, in json
    return json.loads(self.text, **kwargs)
  File &quot;/usr/lib64/python2.7/json/__init__.py&quot;, line 338, in loads
    return _default_decoder.decode(s)
  File &quot;/usr/lib64/python2.7/json/decoder.py&quot;, line 366, in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
  File &quot;/usr/lib64/python2.7/json/decoder.py&quot;, line 384, in raw_decode
    raise ValueError(&quot;No JSON object could be decoded&quot;)
ValueError: No JSON object could be decoded
</code></pre>
<p>찾아보니 python 라이브러리가 없는듯.. 그래서 설치하려고하니..</p>
<pre><code class="language-shell">[root@instance-20190319-second example]# yum install python-pip
error: rpmdb: BDB0113 Thread/process 25892/140479827851072 failed: BDB1507 Thread died in Berkeley DB library
error: db5 error(-30973) from dbenv-&gt;failchk: BDB0087 DB_RUNRECOVERY: Fatal error, run database recovery
error: cannot open Packages index using db5 -  (-30973)
error: cannot open Packages database in /var/lib/rpm
CRITICAL:yum.main:

Error: rpmdb open failed
</code></pre>
<p>띠용.. 또 검색하니 아래와같이 조치를 해주면 된다고 한다.</p>
<blockquote>
<p>뭐하는건진 잘모름..</p>
</blockquote>
<pre><code class="language-shell">rm /var/lib/rpm/__db*
</code></pre>
<p>아래 <code>requests</code> 모듈을 설치해주면 해결!</p>
<pre><code class="language-shell">yum install python-pip
pip install requests
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-13 00:00:00+00:00">August 13, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="uri-url-urn"><a class="toclink" href="../../../../2019/08/13/uri-url-urn-/">URI, URL, URN ???</a></h2>
<h4 id="uri-url-urn_1"><a class="toclink" href="../../../../2019/08/13/uri-url-urn-/#uri-url-urn_1">URI? URL? URN? 뭐가 다른거지?</a></h4>
<p><a href="https://tools.ietf.org/html/rfc3986">URI</a> : <code>Uniform Resource Identifier</code>  </p>
<p>URL : <code>Uniform Resource Locator</code><br />
<a href="https://tools.ietf.org/html/rfc8141">URN</a> : <code>Uniform Resource Name</code>  </p>
<p>일단 <code>URL</code> 과 <code>URN</code> 은 <code>URI</code> 의 Subset 이다.  </p>
<p><code>URL</code> 은 흔히 쓰는 웹상의 주소이고, 아래의 예제와 같이 어떤 자원의 위치를 알려주는 식별자이다.
- https://www.google.com
- https://herdin.github.io/assets/temp/house/20190729_Offer_Notice_Doc____%EB%91%90%EC%82%B0%EC%9C%84%EB%B8%8C.pdf</p>
<p><code>URN</code> 은 잘 사용하지 않는데, 자원의 이름을 의미한다. 하지만 자원이 어디에 위치해 있는지 알려줄 필요는 없다. 보통 <code>urn</code> 으로 시작하며 아래와 같은 모양새를 하고 있다. <a href="https://stackoverflow.com/questions/176264/what-is-the-difference-between-a-uri-a-url-and-a-urn">from StackOverflow</a>
- <code>urn:isbn:0451450523</code>
- <code>urn:uuid:6e8bc430-9c3a-11d9-9669-0800200c9a66</code>
- <code>urn:publishing:book</code></p>
<h4 id="_1"><a class="toclink" href="../../../../2019/08/13/uri-url-urn-/#_1">문법이 있어?</a></h4>
<p><code>URI</code> 는 <code>scheme</code>, <code>authority</code>, <code>path</code>, <code>query</code>, <code>fragment</code> 로 이루어져있다.  </p>
<pre><code>#Syntax Components of URI
scheme &quot;:&quot; hier-part [ &quot;?&quot; query ] [ &quot;#&quot; fragment ]
</code></pre>
<p><code>URL</code> 을 보면 쉽게 이해가 가는데, google 에서 something 을 검색하면 나오는 <code>URL</code> 을 보면 다음과 같다.</p>
<p>https://www.google.com/search?q=something&amp;oq=something&amp;aqs=chrome..69i57j0l4j69i65.3487j0j7&amp;sourceid=chrome&amp;ie=UTF-8</p>
<pre><code class="language-yaml">scheme: https
authority: www.google.com
path: search
query: q=something&amp;oq=something&amp;aqs=chrome..69i57j0l4j69i65.3487j0j7&amp;sourceid=chrome&amp;ie=UTF-8
fragment:
</code></pre>
<p>아래는 <code>RFC</code> 에 나온 <code>URL</code> 과 <code>URN</code> 의 구성</p>
<pre><code>foo://example.com:8042/over/there?name=ferret#nose
\_/   \______________/\_________/ \_________/ \__/
 |           |            |            |        |
scheme     authority       path        query   fragment
 |   _____________________|__
/ \ /                        \
urn:example:animal:ferret:nose
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-09 00:00:00+00:00">August 9, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="aws-cli-window-install"><a class="toclink" href="../../../../2019/08/09/aws-cli-window-install/">AWS CLI window install</a></h2>
<blockquote>
<p><code>gitbook</code> 에서 자료를 옮기다보니 같은날 여러자료가 올라간다.
<code>CLI</code> 는 <code>Command Line Interface</code> 이다.</p>
</blockquote>
<h2 id="window-python"><a class="toclink" href="../../../../2019/08/09/aws-cli-window-install/#window-python">window 환경에서 python 부터 깔자</a></h2>
<p><a href="https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/cli-chap-configure.html">공식 가이드</a></p>
<p>그리고 pip3 을 사용하여 awscli 를 깔자.</p>
<pre><code class="language-shell">&gt; pip3 install awscli --upgrade --user
</code></pre>
<p>다 깔렸으면 버전정보 확인을 하며 설치 확인을 하자.</p>
<pre><code class="language-shell">&gt; aws --version
aws-cli/1.16.189 Python/3.7.2 Windows/10 botocore/1.12.179
</code></pre>
<p>버전확인이 되면 설정을 위해 AWS IAM 에서 사용자를 추가하자.  </p>
<blockquote>
<p>IAM 에서 사용자 추가 AWS Management Console 액세스 체크<br />
Group 생성 AdministratorAccess 체크<br />
IAM 사용자 세부정보 액세스키 만들기, csv 를 저장하던지 어디다적어두던지</p>
</blockquote>
<pre><code class="language-shell">&gt;aws configure
AWS Access Key ID [****************VAU3]: 너의엑세세키를복-붙
AWS Secret Access Key [****************TwYV]: 너의엑세스시크릿을복-붙
Default region name [ap-northeast-2]: ap-northeast-2
Default output format [json]:
&gt; aws ec2 describe-vpcs
{
    &quot;Vpcs&quot;: [
        {
            &quot;CidrBlock&quot;: &quot;123.12.0.0/16&quot;,
            &quot;DhcpOptionsId&quot;: &quot;abc-abc123ab&quot;,
            &quot;State&quot;: &quot;available&quot;,
            &quot;VpcId&quot;: &quot;vpc-abcd1234&quot;,
            &quot;OwnerId&quot;: &quot;123456789012&quot;,
            &quot;InstanceTenancy&quot;: &quot;default&quot;,
            &quot;CidrBlockAssociationSet&quot;: [
                {
                    &quot;AssociationId&quot;: &quot;vpc-cidr-assoc-12345678&quot;,
                    &quot;CidrBlock&quot;: &quot;123.12.0.0/16&quot;,
                    &quot;CidrBlockState&quot;: {
                        &quot;State&quot;: &quot;associated&quot;
                    }
                }
            ],
            &quot;IsDefault&quot;: true,
            &quot;Tags&quot;: [
                {
                    &quot;Key&quot;: &quot;Name&quot;,
                    &quot;Value&quot;: &quot;vpc-default&quot;
                }
            ]
        }
    ]
}
</code></pre>
<blockquote>
<p>완료! 축하한다!</p>
</blockquote>
<p><a href="https://github.com/awslabs/aws-shell">참고로 이런놈도 있다. 더 좋아 보이긴한데...</a></p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-09 00:00:00+00:00">August 9, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="aws-nat-instace-config"><a class="toclink" href="../../../../2019/08/09/aws-nat-instace-config/">AWS NAT instace config</a></h2>
<blockquote>
<p>prod 환경에서 web-was 구성에서  non-dmz 존에 있는 was/db 를 개발/운영자가 접근 할 수 있도록하는 방법을 설명한다.
보통이렇게 한다는데.. 정말?
<code>gitbook</code> 에서 옮기는 중인데, 이거 적을때 막 <code>yaml</code> 을 접해서 <code>yaml</code> 로 적었나보다.</p>
</blockquote>
<h4 id="web-was-aws"><a class="toclink" href="../../../../2019/08/09/aws-nat-instace-config/#web-was-aws">기본적인 WEB-WAS 구성에서의 AWS 구성</a></h4>
<pre><code class="language-yaml">SUBNET:
  vpc:
    az: null
    subnet: 172.31.00.0/16
  default1:
    az: 2a
    subnet: 172.31.00.0/20
  default2:
    az: 2c
    subnet: 172.31.16.0/20
  publicA:
    az: 2a
    subnet: 172.31.32.0/20
  publicC:
    az: 2c
   subnet: 172.31.48.0/20
  privateA:
    az: 2a
    subnet: 172.31.64.0/20
  privateC:
    az: 2c
    subnet: 172.31.80.0/20

ROUTE-TABLE:
  public-route:
    routes:
      - destination:172.31.0.0/16, target:local
      - destination:0.0.0.0/0,     target:INTERNET-GATEWAY
    subnet-associations:
      - publicA
      - publicC
  private-route:
    routes:
      - destination:172.31.0.0/16, target:local
      - destination:0.0.0.0/0,     target:NAT-INSTANCE
    subnet-associations:
      - privateA
      - privateC

SECURITY-GROUP:
  secure-web:
    inbound:
      - tcp 80 from 0.0.0.0/0
      - tcp 80 from ::/0
      - tcp 22 from 0.0.0.0/0 #for ssh
      - tcp 22 from ::/0      #for ssh
    outbound:
      - all 0-65535 from 0.0.0.0/0
  secure-was:
    inbound:
      - tcp 8080 from 0.0.0.0/0 #for was, better from SUBNET publicA, publicC
      - tcp 8080 from ::/0      #for was, better from SUBNET publicA, publicC
      - tcp 22 from 0.0.0.0/0   #for ssh, better from SUBNET publicA, publicC
      - tcp 22 from ::/0        #for ssh, better from SUBNET publicA, publicC
    outbound:
      - all 0-65535 from 0.0.0.0/0
  secure-nat:
    inbound:
      - all 0-65535 from 172.31.64.0/20 #SUBNET privateA
      - all 0-65535 from 172.31.80.0/20 #SUBNET privateC
      - tcp 22 from 0.0.0.0/0
      - tcp 22 from ::/0
    outbound:
      - * 0-65535 from 0.0.0.0/0

EC2:
  web1-2a:
    subnet:
      - publicA
    security-group:
      - secure-web
    disable-source/destination-check: false
  was1-2a:
    subnet:
      - privateA
    security-group:
      - secure-was
    disable-source/destination-check: false
  nat:
    subnet:
      - publicA
    security-group:
      - secure-nat
    disable-source/destination-check: true
</code></pre>
<p>사실 이런걸 해주는 AWS 서비스가 (NAT Gateway) 있는데, 돈을 내야한다.
그러니까 EC2를 하나 더 만들어서 마스커레이딩을 해줘야한다.</p>
<blockquote>
<p>마스커레이딩이란 로컬네트워크에 있는 컴퓨터가 방화벽 기능을 하는 리눅스 서버(또는 게이트웨이/프록시)를 통해서 외부로 데이터 등을 보내려고 할 때, 리눅스 서버가 그 컴퓨터를 '마스커레이딩'한다고 말한다.
<a href="http://egloos.zum.com/gunsystems/v/6784997">고마워요!</a></p>
</blockquote>
<p>먼저 위에서 설정한 <code>EC2-nat instance</code> 에 접속해서 아래 파일을 수정한다.</p>
<pre><code class="language-shell">vi /etc/sysctl.d/nat.conf
</code></pre>
<p>아래와 같이 적어준다.</p>
<blockquote>
<p>뭔진 모른다.</p>
</blockquote>
<pre><code>net.ipv4.ip_forward = 1
net.ipv4.conf.eth0.send_redirects = 0
</code></pre>
<p>그리고 위에서 수정한 설정을 아래와 같이 적용해준다.</p>
<pre><code class="language-shell">sysctl -p /etc/sysctl.d/nat.conf
</code></pre>
<p>아직 안 끝났다. 아래의 파일을 하나 더 열어서..</p>
<pre><code class="language-shell">vi /etc/iptables.rules
</code></pre>
<p>아래와 같이 적어 준다..</p>
<blockquote>
<p>역시 뭔지 모른다.</p>
</blockquote>
<pre><code>*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
-A POSTROUTING -o eth0 -j MASQUERADE
COMMIT
</code></pre>
<p>그리고 또 적용해준다.. ㅠ</p>
<pre><code class="language-shell">/sbin/iptables-restore &lt; /etc/iptables.rules
</code></pre>
<p>이제 <code>NONE-DMZ</code> zone 의 web/db 서버에서 yum install/update 같은 외부 접속이 되는걸 확인한다.</p>
<blockquote>
<p>참고로 <code>NONE-DMZ</code> zone 의 web/db 서버에 접속은 <code>DMZ</code> zone 의 서버에 들어가서 다시 접속을 했다. 이건...또 뭔 서버를 만들면 된다는데 귀찮아...</p>
</blockquote>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-09 00:00:00+00:00">August 9, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="aws-rds-mariadb-config"><a class="toclink" href="../../../../2019/08/09/aws-rds-mariadb-config/">AWS RDS mariadb config</a></h2>
<blockquote>
<p><code>RDS</code> 는 <code>Relational Database Service</code> 이다.</p>
</blockquote>
<ol>
<li>AWS RDS 생성 (free tier)</li>
<li>한글설정을 위한 파라미터 그룹 생성</li>
<li>아래의 6가지 utf-8 설정<ul>
<li>character_set_client</li>
<li>character_set_server</li>
<li>character_set_client</li>
<li>character_set_database</li>
<li>character_set_filesystem</li>
<li>character_set_results</li>
</ul>
</li>
<li>아래의 2가지 utf8_general_ci 설정<ul>
<li>collation_connection</li>
<li>collation_server</li>
</ul>
</li>
<li>EC2 보안그룹 생성</li>
<li>인바운드 규칙 기본VPC, TCP 3306 위치무관</li>
<li>(2, 3) 에서 만든 파라미터그룹, 보안그룹을 적용</li>
<li>HeidiSQL 에서 TCP 연결, 엔드포인트의 host/port</li>
<li>끝.</li>
</ol>
<blockquote>
<p>그냥 만들어도 되던데.....??</p>
</blockquote>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-09 00:00:00+00:00">August 9, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="gcpgoogle-cloud-platform-ssh-instace"><a class="toclink" href="../../../../2019/08/09/gcpgoogle-cloud-platform-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-ssh-%EB%A1%9C-instace-%EC%A0%91%EC%86%8D/">GCP(Google Cloud Platform) 시작하기, ssh 로 Instace 접속</a></h2>
<p><code>AWS</code> 를 학원에서 배우고나서 클라우드에 관심을 갖게 되었다.<br />
<code>AWS</code> 는 1년이 공짜지만, <code>GCP</code> 는 특정 지역에 특정 instace 는 평생 무료다!!!!!!</p>
<blockquote>
<p>아래는 2019-08-09 현재 올려져있는 무료한도이다.</p>
</blockquote>
<hr />
<h4 id="_1"><a class="toclink" href="../../../../2019/08/09/gcpgoogle-cloud-platform-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-ssh-%EB%A1%9C-instace-%EC%A0%91%EC%86%8D/#_1">항상 무료 사용 한도</a></h4>
<p>Compute Engine은 <a href="https://cloud.google.com/free/">Google Cloud Platform</a> 무료 등급의 일환으로 특정 한도까지 일정량을 무료로 사용할 수 있습니다. 무료 사용량은 무료 평가판 기간 중은 물론 이후에도 사용할 수 있습니다. 이 사용 한도를 소진했고 무료 평가판 사용 기간이 종료된 경우 가격표에 따라 요금이 청구됩니다.</p>
<ul>
<li>다음 미국 리전 중 한 곳에서 비선점형 f1-micro VM 인스턴스 1개/월:</li>
<li>오리건: <code>us-west1</code></li>
<li>아이오와: <code>us-central1</code></li>
<li>사우스캐롤라이나: <code>us-east1</code></li>
<li><a href="https://cloud.google.com/compute/docs/disks">표준 영구 디스크 스토리지</a> <strong>30GB</strong>/월</li>
<li>스냅샷 스토리지 5GB/월. 다음 리전으로 제한됩니다.</li>
<li>오리건: <code>us-west1</code></li>
<li>아이오와: <code>us-central1</code></li>
<li>사우스캐롤라이나: <code>us-east1</code></li>
<li>타이완: <code>asia-east1</code></li>
<li>벨기에: <code>europe-west1</code></li>
<li>네트워크 트래픽 한도:</li>
<li>프리미엄 등급을 사용해야 합니다. 표준 등급은 사용할 수 없습니다.</li>
<li>트래픽 전송은 북미의 GCP 리전에서 시작되어야 합니다.</li>
<li>도합 최대 1GB의 이그레스 트래픽을 오세아니아와 중국을 제외한 리전으로 보낼 수 있습니다.</li>
</ul>
<p>f1-micro 인스턴스의 경우 이번 달에 해당하는 시간 전체가 무료 사용량으로 제공되며, 이 한도는 한 달 내내 인스턴스 하나를 중단 없이 실행하기에 충분합니다. 예를 들어 8월 한 달은 744시간(31일 x 24시간)이므로 8월에 무료로 사용할 수 있는 인스턴스 시간은 744시간입니다.</p>
<p><a href="https://cloud.google.com/compute/docs/instances/preemptible">선점형 VM 인스턴스</a>는 Google Cloud Platform 무료 등급에 포함되지 않습니다.</p>
<p>여러 리전에서 모든 사용량이 집계됩니다. 상시 무료 사용 한도는 변경될 수 있습니다. 자격 요건 및 기타 제한사항은 <a href="https://cloud.google.com/free/docs/gcp-free-tier">FAQ</a>를 참조하세요.</p>
<hr />
<h4 id="_2"><a class="toclink" href="../../../../2019/08/09/gcpgoogle-cloud-platform-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-ssh-%EB%A1%9C-instace-%EC%A0%91%EC%86%8D/#_2">접속하기</a></h4>
<h5 id="windows"><a class="toclink" href="../../../../2019/08/09/gcpgoogle-cloud-platform-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-ssh-%EB%A1%9C-instace-%EC%A0%91%EC%86%8D/#windows">windows</a></h5>
<p>위에 해당하는 instance 를 만들고 나면 아마 별도의 권한없이 그냥 열려있을텐데,<br />
private key 를 만들어서 해당 key 를 갖고 있는 사람만 접속가능하게 한다.</p>
<p><img alt="putty-image" src="/assets/images/posts/2019-08-09-gcp-init.PNG" /></p>
<ul>
<li><a href="from https://www.putty.org/">PUTTYGEN 을 다운 받는다.</a></li>
<li>generate</li>
<li>Key comment : 사용할 USER ID (for ssh connect id)</li>
<li>맨 위의 public key 를 복사한다. (google cloud platform 에 metadata 로 저장할 용도)</li>
<li>save private key (putty 설정에 사용 - ssh - auth - private key)</li>
<li><a href="https://console.cloud.google.com">connect goolge cloud console</a></li>
<li>compute engine - metadata - SSH keys - Edit</li>
<li>4번 내용을 key data 에 추가한다.</li>
<li>5번 putty 설정이 된 putty 로 접속하면 된다. 위에서 지정했던 USER ID 로 접속.</li>
</ul>
<h5 id="mac-os"><a class="toclink" href="../../../../2019/08/09/gcpgoogle-cloud-platform-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-ssh-%EB%A1%9C-instace-%EC%A0%91%EC%86%8D/#mac-os">mac os</a></h5>
<ul>
<li>아래 명령어로 공개키와 비밀키 페어를 만든다. 비밀번호 입력하라면 안해도된다.</li>
<li>aws 같은 경우 .pem 키를 그대로 사용하면된다.</li>
</ul>
<pre><code class="language-shell">$ ssh-keygen -t rsa -f ${file location} -C &quot;${email address}&quot;
</code></pre>
<blockquote>
<p>ssh-keygen 은 기본으로 깔려있나보다.</p>
</blockquote>
<ul>
<li><code>.pub/.pem</code> 확장자인 공개키 내용을 복사해서 gcp vm instance 메뉴의 meta data ssh 에 내용을 복붙한다.</li>
<li>위의 비밀키로 아래와 같이 접속하면 끝.</li>
</ul>
<pre><code class="language-shell">$ ssh -i ${private key location} ${id}@${gcp external ip address}
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-09 00:00:00+00:00">August 9, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="gcp-tomcat-to-aws-rds"><a class="toclink" href="../../../../2019/08/09/gcp-tomcat-to-aws-rds/">GCP tomcat to AWS rds</a></h2>
<pre><code class="language-shell">#aws rds : mariadb
#error log
### Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Could not get JDBC Connection; nested exception is org.apache.commons.dbcp.SQLNestedException: Cannot create PoolableConnectionFactory (Could not connect to {aws_mariadb_ip_number}:{port} : Permission denied (connect failed))

#add jvm option to
#/usr/share/tomcat/conf/tomcat.conf
JAVA_OPTS=&quot;-Djava.net.preferIPv4Stack=true&quot;
#and catalina log for check jvm option
#/var/log/tomcat/catalina.2019-04-10.log
Apr 10, 2019 1:24:55 PM org.apache.catalina.startup.VersionLoggerListener log
INFO: Command line argument: -Djava.net.preferIPv4Stack=true

#driver class name change to default (origin ip number)
jdbc:mariadb://{aws_mariadb_endpoint}:{port}/{database_name}

#mvn test
2019-04-10 13:49:48.606 DEBUG --- [ main ] o.m.s.t.SpringManagedTransaction : JDBC Connection [jdbc:mysql://{aws_mariadb_endpoint}:{port}/{database_name}, UserName={user_name}, mariadb-jdbc] will not be managed by Spring
2019-04-10 13:49:48.607 DEBUG --- [ main ] sql.list.selectList : ooo Using Connection [jdbc:mysql://{aws_mariadb_endpoint}:{port}/{database_name}, UserName={user_name}, mariadb-jdbc]
2019-04-10 13:49:48.629 DEBUG --- [ main ] sql.list.selectList : ==&gt;  Preparing: SELECT id ,header ,description ,imgUrl FROM LIST WHERE 1=1
2019-04-10 13:49:48.684 DEBUG --- [ main ] sql.list.selectList : ==&gt; Parameters:
2019-04-10 13:49:48.876 DEBUG --- [ main ] o.m.s.SqlSessionUtils : Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@609e8838]
2019-04-10 13:49:48.877 DEBUG --- [ main ] o.s.j.d.DataSourceUtils : Returning JDBC Connection to DataSource
#mvn package
#/usr/share/tomcat -&gt; /var/lib/tomcat ?
#/var/log/tomcat/
Caused by: java.net.SocketException: Permission denied (connect failed)
        at java.net.PlainSocketImpl.socketConnect(Native Method)
        at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)
        at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)
        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)
        at java.net.Socket.connect(Socket.java:589)
        at java.net.Socket.connect(Socket.java:538)
        at org.mariadb.jdbc.internal.mysql.MySQLProtocol.connect(MySQLProtocol.java:372)
        at org.mariadb.jdbc.internal.mysql.MySQLProtocol.connect(MySQLProtocol.java:673)
#so modify /usr/share/tomcat/conf/catalina.policy
grant codeBase &quot;jar:file:${catalina.base}/webapps/SimpleSpring/WEB-INF/lib/mariadb-java-client-1.1.7.jar!/-&quot; {
     permission java.net.SocketPermission &quot;{aws_mariadb_endpoint}:{port}&quot;, &quot;connect&quot;;
};
#but fail..

</code></pre>
<blockquote>
<p>생각 없이 yum install tomcat 해서 깔린 tomcat 을 사용하니까 자꾸<br />
java.net.SocketException: Permission denied 에러가 나서<br />
catalina.policy 도 건드렸는데 안되고..<br />
nodejs 설치해서 올려보면 db connection 잘 되고..<br />
한 3-4일 삽질한듯..<br />
docker 공식 tomcat 이미지에 올려보니 잘된다. 뭔가 그냥 yum install tomcat 하면 설정이 다른가본데...<br />
잘모르겠다 아무튼 해결..</p>
</blockquote>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-08 00:00:00+00:00">August 8, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              3 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="coverage-tool-codecov"><a class="toclink" href="../../../../2019/08/08/coverage-tool-codecov/">Coverage tool Codecov</a></h2>
<p><img data-v-b7054844="" alt="Logo" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTI1LjAxNCAwQzExLjIzLjAxLjAxIDExLjE0OSAwIDI0LjgzMnYuMDYybDQuMjU0IDIuNDgyLjA1OC0uMDM5YTEyLjIzOCAxMi4yMzggMCAwIDEgOS4wNzgtMS45MjggMTEuODQ0IDExLjg0NCAwIDAgMSA1Ljk4IDIuOTc1bC43My42OC40MTMtLjkwNGMuNC0uODc0Ljg2Mi0xLjY5NiAxLjM3NC0yLjQ0My4yMDYtLjMuNDMzLS42MDQuNjkyLS45MjlsLjQyNy0uNTM1LS41MjYtLjQ0YTE3LjQ1IDE3LjQ1IDAgMCAwLTguMS0zLjc4MSAxNy44NTMgMTcuODUzIDAgMCAwLTguMzc1LjQ5YzIuMDIzLTguODY4IDkuODItMTUuMDUgMTkuMDI3LTE1LjA1NyA1LjE5NSAwIDEwLjA3OCAyLjAwNyAxMy43NTIgNS42NTIgMi42MTkgMi41OTggNC40MjIgNS44MzUgNS4yMjQgOS4zNzJhMTcuOTA4IDE3LjkwOCAwIDAgMC01LjIwOC0uNzlsLS4zMTgtLjAwMWExOC4wOTYgMTguMDk2IDAgMCAwLTIuMDY3LjE1M2wtLjA4Ny4wMTJjLS4zMDMuMDQtLjU3LjA4MS0uODEzLjEyNi0uMTE5LjAyLS4yMzcuMDQ1LS4zNTUuMDY4LS4yOC4wNTctLjU1NC4xMTktLjgxNi4xODVsLS4yODguMDczYy0uMzM2LjA5LS42NzUuMTkxLTEuMDA2LjNsLS4wNjEuMDJjLS43NC4yNTEtMS40NzguNTU4LTIuMTkuOTE0bC0uMDU3LjAyOWMtLjMxNi4xNTgtLjYzNi4zMzMtLjk3OC41MzRsLS4wNzUuMDQ1YTE2Ljk3IDE2Ljk3IDAgMCAwLTQuNDE0IDMuNzhsLS4xNTcuMTkxYy0uMzE3LjM5NC0uNTY3LjcyNy0uNzg3IDEuMDQ4LS4xODQuMjctLjM2OS41Ni0uNi45NDJsLS4xMjYuMjE3Yy0uMTg0LjMxOC0uMzQ4LjYyMi0uNDg3LjlsLS4wMzMuMDYxYy0uMzU0LjcxMS0uNjYxIDEuNDU1LS45MTcgMi4yMTRsLS4wMzYuMTExYTE3LjEzIDE3LjEzIDAgMCAwLS44NTUgNS42NDRsLjAwMy4yMzRhMjMuNTY1IDIzLjU2NSAwIDAgMCAuMDQzLjgyMmMuMDEuMTMuMDIzLjI1OS4wMzYuMzg4LjAxNS4xNTguMDM0LjMxNi4wNTMuNDcxbC4wMTEuMDg4LjAyOC4yMTRjLjAzNy4yNjQuMDguNTI1LjEzLjc4Ny41MDMgMi42MzcgMS43NiA1LjI3NCAzLjYzNSA3LjYyNWwuMDg1LjEwNi4wODctLjEwNGMuNzQ4LS44ODQgMi42MDMtMy42ODcgMi43Ni01LjM2OWwuMDAzLS4wMzEtLjAxNS0uMDI4YTExLjczNiAxMS43MzYgMCAwIDEtMS4zMzMtNS40MDdjMC02LjI4NCA0Ljk0LTExLjUwMiAxMS4yNDMtMTEuODhsLjQxNC0uMDE1YzIuNTYxLS4wNTggNS4wNjQuNjczIDcuMjMgMi4xMzZsLjA1OC4wMzkgNC4xOTctMi40NC4wNTUtLjAzM3YtLjA2MmMuMDA2LTYuNjMyLTIuNTkyLTEyLjg2NS03LjMxNC0xNy41NTFDMzcuOTcgMi41NzYgMzEuNjk1IDAgMjUuMDE0IDAiIGZpbGw9IiNGMDFGN0EiIGZpbGwtcnVsZT0iZXZlbm9kZCIvPjwvc3ZnPg==" /></p>
<p><a href="https://codecov.io/">Codecov 공식홈페이지</a></p>
<blockquote>
<p>Improve your code review workflow and quality. Codecov provides highly integrated tools to group, merge, archive, and compare coverage reports.<br />
Free for open source. Plans starting at $2.50/month per repository.</p>
</blockquote>
<p>라고 설명한다.</p>
<p>코드 커버리지 오픈소스 툴이고 <code>Github</code> 연동이다.<br />
오픈소스는 무료! 그외엔 월당 2.5$  </p>
<h4 id="_1"><a class="toclink" href="../../../../2019/08/08/coverage-tool-codecov/#_1">그래서 뭐에 쓰는건데?</a></h4>
<p><code>Codecov</code> 에선 <code>code coverage</code> 측정을 아래와 같이 한다고 한다.</p>
<blockquote>
<ul>
<li><strong>hit</strong> indicates that the source code was executed by the test suite.
<strong>partial</strong> indicates that the source code was not fully executed by the test suite; there are remaining branches that were not executed.
<strong>miss</strong> indicates that the source code was not executed by the test suite.</li>
</ul>
<p>Coverage is the ratio of hits / (sum of hit + partial + miss)</p>
</blockquote>
<p>테스트케이스에서 실제로 몇라인이나 사용했는지를 테스트케이스의 성공유무 상관없이 정적 분석을 하는 듯 하다. 명시적으로 불리지 않는 코드는 카운트가 안되는 것 같다.</p>
<blockquote>
<p>자존감이 낮아 확신도 없다.</p>
</blockquote>
<h4 id="slack"><a class="toclink" href="../../../../2019/08/08/coverage-tool-codecov/#slack">Slack 연동 하다가 실패.. 는 성공의 어머니!!!!</a></h4>
<p><a href="https://docs.codecov.io/docs/notifications">공식 문서</a></p>
<p>공식문서에 나온대로 <code>.codecov.yml</code> 파일을 만들고 url 만 변경하여 커밋을 했는데 메세지가 안온다..</p>
<blockquote>
<p>아래 텍스트는 가이드에있는 것을 그대로 복붙 한 것이다.</p>
</blockquote>
<pre><code class="language-yaml">coverage:
  notify:
    slack:
      default:
        url: &quot;https://hooks.slack.com/your/webhook/url&quot;
        threshold: 1%
              only_pulls: false
        branches: null
        flags: null
                paths: null
</code></pre>
<p>이것저것 검색하다보니 설정파일이 좀 수상해서<br />
양식을 체크하기위해 공식문서에선 <code>Powershell</code> 에서 아래의 명령어로 확인하라고 한다</p>
<pre><code class="language-shell"># PowerShell Sample
Invoke-RestMethod -Uri https://codecov.io/validate -Body (Get-Content -Raw -LiteralPath .\.codecov.yml) -Method post
</code></pre>
<p>그럼 아래와 같은 에러가 난다.</p>
<pre><code class="language-shell">Invoke-RestMethod : 요청이 중단되었습니다. SSL/TLS 보안 채널을 만들 수 없습니다.
위치 줄:1 문자:1
+ Invoke-RestMethod -Uri https://codecov.io/validate -Body (Get-Content ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (System.Net.HttpWebRequest:HttpWebRequest) [Invoke-RestMethod], WebExc
   eption
    + FullyQualifiedErrorId : WebCmdletWebResponseException,Microsoft.PowerShell.Commands.InvokeRestMethodCommand
</code></pre>
<p>구글링을 해보면 <code>god stackoverflow</code> 형님들이 아래와같은 명령어를 치라고 한다.</p>
<blockquote>
<p>이쯤되면 마리오네뜨..</p>
</blockquote>
<pre><code class="language-shell">[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
#또는
[Net.ServicePointManager]::SecurityProtocol =
  [Net.SecurityProtocolType]::Tls12 -bor `
  [Net.SecurityProtocolType]::Tls11 -bor `
  [Net.SecurityProtocolType]::Tls
#또는
[Net.ServicePointManager]::SecurityProtocol = &quot;tls12, tls11, tls&quot;
#나는 마지막 명령어를 사용했다.
</code></pre>
<blockquote>
<p>Powershell 의 TLS 버전과 서버의 TLS 버전이 다른다는데 TLS 가 뭔지는.. <a href="https://soul0.tistory.com/510">따로 공부하도록 하자</a></p>
</blockquote>
<p>아무튼 위의 설정파일 양식설정을 이리저리 만지다보면 아래와 같은 설정으로 조정할 수 있다.</p>
<pre><code class="language-yaml">coverage:
  notify:
    slack:
      default:
        url: &quot;https://hooks.slack.com/your/webhook/url&quot;
        threshold: 1%
        only_pulls: false
        branches: master
        flags: null
        paths: null
</code></pre>
<p>위의 설정파일은 아래와 같은 성공 메세지를 주지만..</p>
<pre><code class="language-shell">Invoke-RestMethod -Uri https://codecov.io/validate -Body (G
et-Content -Raw -LiteralPath .\.codecov.yml) -Method post
Valid!

{
  &quot;coverage&quot;: {
    &quot;notify&quot;: {
      &quot;slack&quot;: {
        &quot;default&quot;: {
          &quot;paths&quot;: null,
          &quot;branches&quot;: [
            &quot;^master$&quot;
          ],
          &quot;url&quot;: &quot;https://hooks.slack.com/your/webhook/url&quot;,
          &quot;only_pulls&quot;: false,
          &quot;threshold&quot;: 1.0,
          &quot;flags&quot;: null
        }
      }
    }
  }
}
</code></pre>
<p>문제는 <code>Codecov</code> 가 웹훅메세지를 안쏜다....................................................<br />
내심 별 문제가 아니길 빈다.  </p>
<p><code>Codecov</code> 에 메일로 물어봤더니 오픈소스는 포럼에다물어보라길래<br />
포럼을 뒤적거렸더니 누군가 나와같은 바보짓을 하고있었고<br />
답변은 threshold 보다 코드커버리지가 변동이 없어서 그렇다라는것을 보고<br />
물론 물어본자식은 0.0으로 해도 안되고 없애도 안된다고 징징대긴 했다만..<br />
테스트케이스를 추가해서 코드커버리지를 늘렸더니</p>
<p><img alt="yes" src="/assets/images/posts/2019-08-08-coverage-codecov.PNG" /></p>
<blockquote>
<p><code>threshold</code> 를 없애면 변동이 없어도 알람이 온다.</p>
</blockquote>
<h4 id="token-webhook-url"><a class="toclink" href="../../../../2019/08/08/coverage-tool-codecov/#token-webhook-url">token 이 들어가있는 webhook url 를 그냥 사용하지 말자</a></h4>
<p><code>Codecov</code> 의 repository 의 setting 의 yaml 쪽 메뉴를 보면 <code>Secret string</code> 을 생성하는 기능이 있다.  </p>
<pre><code class="language-shell">this_is_secret!
</code></pre>
<p>위의 데이터를 해당 기능으로 암호화하면</p>
<pre><code class="language-shell">secret:7OiGq3efZNP1c75xP85gj7twlp8xTnbhmB0TgQ+3EGgyulX1Q5OST73yMET+jsom8j8SSUVN6bEB4c+5UtGRQQ==
</code></pre>
<p>위와 같은 텍스트를 주는데 이걸 <code>.codecov.yml</code> 파일에서 사용하면 된다.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-08 00:00:00+00:00">August 8, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              1 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="centos-with-docker"><a class="toclink" href="../../../../2019/08/08/centos-with-docker/">centos with docker</a></h2>
<p><code>docker.io/centos:7</code> 부터는 기본적으로 <code>ifconfig</code> 가 없고 <code>ip</code> 라는 명령이 추가된 것 같은데,<br />
막상 docker 에서 실행해 보면 안나온다.. 떠그랄</p>
<pre><code class="language-shell">yum install -y net-tools
#굳이 ifconfig 를 사용하기 위해서 저걸 깐다.
</code></pre>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2019-08-08 00:00:00+00:00">August 8, 2019</time></li>
        
        
          
          <li class="md-meta__item">
            
              2 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="1-docker-redis"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/">1. docker redis 맛보기</a></h2>
<h3 id="11"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#11">1.1.  일단 띄워보기</a></h3>
<pre><code class="language-shell">#redis docker run
docker run -d --name SAredis redis:latest
</code></pre>
<blockquote>
<p>이러면 뜨긴뜬다 일단은..</p>
</blockquote>
<h3 id="12-centoscontainer-rediscontainer"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#12-centoscontainer-rediscontainer">1.2. CentOS(container) - Redis(container) 연동</a></h3>
<blockquote>
<p>docker link 를 사용하므로 권장하지 않음</p>
</blockquote>
<pre><code class="language-shell">#make linux, install redis-cli, connect redis container

#centos for redis-cli
docker run -it --link SAredis:inredis --name SAcentos centos:latest

#now we are in centos
#install wget, gcc, make
yum install -y wget &amp;&amp; yum install -y gcc &amp;&amp; yum install -y make
#download redis-cli, uncompress, compile
wget http://download.redis.io/redis-stable.tar.gz &amp;&amp; tar xvzf redis-stable.tar.gz &amp;&amp; cd redis-stable &amp;&amp; make
#regist redis-cli for easyuse
cp src/redis-cli /usr/bin/
#connect redis-server
redis-cli -h inredis -p 6379
#user redis now!
&gt;set hello redisWorld
&gt;get hello
&quot;redisWorld&quot;
</code></pre>
<h4 id="13"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#13">1.3. 개발용으로 일회성으로만 사용하려면..</a></h4>
<blockquote>
<p>rm 옵션으로 종료시 삭제되도록한다. 별로 의미는 없음.</p>
</blockquote>
<pre><code class="language-shell">#just use one-time container for redis-cli
docker run -it --link SAredis:inredis --rm redis redis-cli -h inredis -p 6379
&gt;get hello
&quot;redisWorld&quot;
</code></pre>
<h4 id="host-volume"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#host-volume">host 파일 사용하기 (volume 공유하기)</a></h4>
<pre><code class="language-shell">docker run
-d
--name test-vault
-p 8201:8200
-v /tools/vault/data/file:/vault/file
-v /tools/vault/data/logs:/vault/logs
docker.io/vault:1.1.2
</code></pre>
<p>왜 뜬금없이 <code>vault</code> 냐면, 예전에 이렇게 실행했다가 알 수 없는 <code>permission denied</code> 가 떠서 한참 찾다 포기했는데,  이번에 <code>redis</code> 설정하면서도 똑같이..</p>
<pre><code class="language-shell">docker run
-d
--name tredis
-p 6379:6379
-v /tools/redis/data:/data
docker.io/redis:4-alpine
</code></pre>
<p>저렇게 했더니 container 가 실행하자마자 죽어서 로그를 보니, container 내부에서 volume 설정하다가 <code>permission denied</code> 가 똑같이 떠서 다시한번 한참 구글링을 했는데</p>
<p><a href="https://stackoverflow.com/questions/24288616/permission-denied-on-accessing-host-directory-in-docker">갓 스택플로우!!!</a></p>
<p>끝에 <code>z</code> or <code>Z</code> 를 붙이면 자동으로 <code>chcon</code> 을 써주면서 해결된다. <code>Z</code> 보단 <code>z</code> 가 나은 것 같다.</p>
<pre><code class="language-shell">-v /host/dir:/container/dir:z
-v /host/dir:/container/dir:Z
</code></pre>
<p>위의 옵션을 사용하면 아래의 명령어를 자동으로 사용해준다고 한다.....</p>
<pre><code class="language-shell">chcon -Rt svirt_sandbox_file_t /container/dir #z 사용시
chcon -Rt svirt_sandbox_file_t -l s0:c1,c2 /container/dir #Z 사용시
</code></pre>
<p>(참고는 했지만 이해는 안된다.)[http://www.projectatomic.io/blog/2015/06/using-volumes-with-docker-can-cause-problems-with-selinux/]</p>
<p>그럼 저 빌어먹을 <code>z</code> , <code>Z</code> 옵션은 뭐냐?</p>
<h4 id="_1"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#_1">설정도해보자</a></h4>
<p>(redis 기본설정인것 같은데 잘 안된다.)[http://download.redis.io/redis-stable/redis.conf]</p>
<p>아래의 명령어와 설정파일을를 사용하고 있는데...</p>
<blockquote>
<p>아래는 명령어</p>
</blockquote>
<pre><code class="language-shell">docker run
-d
--name tredis
-p 6379:6379
-v /tools/redis/data:/data:z
-v /tools/redis/redis.conf:/usr/local/etc/redis/redis.conf:z
docker.io/redis:4-alpine
redis-server /usr/local/etc/redis/redis.conf
</code></pre>
<h5 id="redisconf"><a class="toclink" href="../../../../2019/08/08/redis-with-docker/#redisconf">redis.conf</a></h5>
<pre><code class="language-shell">daemonize no
port 6379
requirepass [CONFIG_REDISPASSWORD]
#not specify than accept every connect ex: bind 127.0.0.1
#bind [IP]

#connection idle continued by SECONDS than close connection
#timeout [SECONDS]

#debug/verbose/notice/warning
loglevel notice

#index from 0
#databases [database count]

#900seconds, 1chagne than save
save 900 1

dbfilename tredis-snapshot.rdb
#logfile /usr/local/etc/redis/redis.log
dir /data
</code></pre>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  <a class="md-pagination__link" href="../../">1</a> <span class="md-pagination__dots">..</span> <a class="md-pagination__link" href="../3/">3</a> <a class="md-pagination__link" href="../4/">4</a> <span class="md-pagination__current">5</span> <a class="md-pagination__link" href="../6/">6</a> <a class="md-pagination__link" href="../7/">7</a> <a class="md-pagination__link" href="../8/">8</a>
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": [], "search": "../../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": {"Compatibility": "compat", "rabbitmq": "rabbitmq"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.f13b1293.min.js"></script>
      
    
  </body>
</html>